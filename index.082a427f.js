!function(){function e(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var i,o,n,s,a,l,h=function(){function e(){}var t=e.prototype;return t.unwrap=function(e,t){var r=this._chain(function(t){return l.ok(e?e(t):t)},function(e){return t?l.ok(t(e)):l.err(e)});if(r.isErr)throw r.error;return r.value},t.map=function(e,t){return this._chain(function(t){return l.ok(e(t))},function(e){return l.err(t?t(e):e)})},t.chain=function(e,t){return this._chain(e,t||function(e){return l.err(e)})},e}(),c=function(e){function r(t){var r;return(r=e.call(this)||this).value=void 0,r.isOk=!0,r.isErr=!1,r.value=t,r}return t(r,e),r.prototype._chain=function(e,t){return e(this.value)},r}(h),u=function(e){function r(t){var r;return(r=e.call(this)||this).error=void 0,r.isOk=!1,r.isErr=!0,r.error=t,r}return t(r,e),r.prototype._chain=function(e,t){return t(this.error)},r}(h);(i=l||(l={})).ok=function(e){return new c(e)},i.err=function(e){return new u(e||Error())},i.all=function(e){if(Array.isArray(e)){for(var t=[],r=0;r<e.length;r++){var o=e[r];if(o.isErr)return o;t.push(o.value)}return i.ok(t)}for(var n={},s=Object.keys(e),a=0;a<s.length;a++){var l=e[s[a]];if(l.isErr)return l;n[s[a]]=l.value}return i.ok(n)};let d=e=>(e-=e>>>1&0x55555555,Math.imul((e=(0x33333333&e)+(e>>>2&0x33333333))+(e>>>4)&0xf0f0f0f,0x1010101)>>24),p=e=>(e=e>>>8&0xff00ff|(0xff00ff&e)<<8)>>>16&65535|(65535&e)<<16,f=e=>p(e=(e=(e=e>>>1&0x55555555|(0x55555555&e)<<1)>>>2&0x33333333|(0x33333333&e)<<2)>>>4&0xf0f0f0f|(0xf0f0f0f&e)<<4);class m{constructor(e,t){this.lo=0|e,this.hi=0|t}static fromSquare(e){return e>=32?new m(0,1<<e-32):new m(1<<e,0)}static fromRank(e){return new m(255,0).shl64(8*e)}static fromFile(e){return new m(0x1010101<<e,0x1010101<<e)}static empty(){return new m(0,0)}static full(){return new m(0xffffffff,0xffffffff)}static corners(){return new m(129,0x81000000)}static center(){return new m(0x18000000,24)}static backranks(){return new m(255,0xff000000)}static backrank(e){return"white"===e?new m(255,0):new m(0,0xff000000)}static lightSquares(){return new m(0x55aa55aa,0x55aa55aa)}static darkSquares(){return new m(0xaa55aa55,0xaa55aa55)}complement(){return new m(~this.lo,~this.hi)}xor(e){return new m(this.lo^e.lo,this.hi^e.hi)}union(e){return new m(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new m(this.lo&e.lo,this.hi&e.hi)}diff(e){return new m(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?m.empty():e>=32?new m(this.hi>>>e-32,0):e>0?new m(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?m.empty():e>=32?new m(0,this.lo<<e-32):e>0?new m(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new m(p(this.hi),p(this.lo))}rbit64(){return new m(f(this.hi),f(this.lo))}minus64(e){let t=this.lo-e.lo,r=(t&e.lo&1)+(e.lo>>>1)+(t>>>1)>>>31;return new m(t,this.hi-(e.hi+r))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return d(this.lo)+d(this.hi)}isEmpty(){return 0===this.lo&&0===this.hi}nonEmpty(){return 0!==this.lo||0!==this.hi}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!=0}set(e,t){return t?this.with(e):this.without(e)}with(e){return e>=32?new m(this.lo,this.hi|1<<e-32):new m(this.lo|1<<e,this.hi)}without(e){return e>=32?new m(this.lo,this.hi&~(1<<e-32)):new m(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new m(this.lo,this.hi^1<<e-32):new m(this.lo^1<<e,this.hi)}last(){return 0!==this.hi?63-Math.clz32(this.hi):0!==this.lo?31-Math.clz32(this.lo):void 0}first(){return 0!==this.lo?31-Math.clz32(this.lo&-this.lo):0!==this.hi?63-Math.clz32(this.hi&-this.hi):void 0}withoutFirst(){return 0!==this.lo?new m(this.lo&this.lo-1,this.hi):new m(0,this.hi&this.hi-1)}moreThanOne(){return 0!==this.hi&&0!==this.lo||(this.lo&this.lo-1)!=0||(this.hi&this.hi-1)!=0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,t=this.hi;for(;0!==e;){let t=31-Math.clz32(e&-e);e^=1<<t,yield t}for(;0!==t;){let e=31-Math.clz32(t&-t);t^=1<<e,yield 32+e}}*reversed(){let e=this.lo,t=this.hi;for(;0!==t;){let e=31-Math.clz32(t);t^=1<<e,yield 32+e}for(;0!==e;){let t=31-Math.clz32(e);e^=1<<t,yield t}}}let g=["a","b","c","d","e","f","g","h"],b=["1","2","3","4","5","6","7","8"],w=["white","black"],v=["pawn","knight","bishop","rook","queen","king"],k=["a","h"],y=e=>"role"in e,C=e=>void 0!==e,x=e=>"white"===e?"black":"white",S=e=>e>>3,E=e=>7&e,M=(e,t)=>0<=e&&e<8&&0<=t&&t<8?e+8*t:void 0,P=e=>{switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function q(e){if(2===e.length)return M(e.charCodeAt(0)-97,e.charCodeAt(1)-49)}let R=e=>g[E(e)]+b[S(e)],A=e=>y(e)?`${P(e.role).toUpperCase()}@${R(e.to)}`:R(e.from)+R(e.to)+(e.promotion?P(e.promotion):""),O=(e,t)=>"white"===e?"a"===t?2:6:"a"===t?58:62,N=(e,t)=>"white"===e?"a"===t?3:5:"a"===t?59:61,K=(e,t)=>{let r=m.empty();for(let i of t){let t=e+i;0<=t&&t<64&&2>=Math.abs(E(e)-E(t))&&(r=r.with(t))}return r},T=e=>{let t=[];for(let r=0;r<64;r++)t[r]=e(r);return t},F=T(e=>K(e,[-9,-8,-7,-1,1,7,8,9])),D=T(e=>K(e,[-17,-15,-10,-6,6,10,15,17])),_={white:T(e=>K(e,[7,9])),black:T(e=>K(e,[-7,-9]))},L=e=>F[e],B=e=>D[e],I=(e,t)=>_[e][t],$=T(e=>m.fromFile(E(e)).without(e)),z=T(e=>m.fromRank(S(e)).without(e)),W=T(e=>{let t=new m(0x8040201,0x80402010),r=8*(S(e)-E(e));return(r>=0?t.shl64(r):t.shr64(-r)).without(e)}),H=T(e=>{let t=new m(0x10204080,0x1020408),r=8*(S(e)+E(e)-7);return(r>=0?t.shl64(r):t.shr64(-r)).without(e)}),j=(e,t,r)=>{let i=r.intersect(t),o=i.bswap64();return i=i.minus64(e),o=o.minus64(e.bswap64()),i.xor(o.bswap64()).intersect(t)},V=(e,t)=>j(m.fromSquare(e),$[e],t),Q=(e,t)=>{let r=z[e],i=t.intersect(r),o=i.rbit64();return i=i.minus64(m.fromSquare(e)),o=o.minus64(m.fromSquare(63-e)),i.xor(o.rbit64()).intersect(r)},U=(e,t)=>{let r=m.fromSquare(e);return j(r,W[e],t).xor(j(r,H[e],t))},G=(e,t)=>V(e,t).xor(Q(e,t)),Y=(e,t)=>U(e,t).xor(G(e,t)),X=(e,t)=>{let r=m.fromSquare(t);return z[e].intersects(r)?z[e].with(e):H[e].intersects(r)?H[e].with(e):W[e].intersects(r)?W[e].with(e):$[e].intersects(r)?$[e].with(e):m.empty()},Z=(e,t)=>X(e,t).intersect(m.full().shl64(e).xor(m.full().shl64(t))).withoutFirst();class J{constructor(){}static default(){let e=new J;return e.reset(),e}reset(){this.occupied=new m(65535,0xffff0000),this.promoted=m.empty(),this.white=new m(65535,0),this.black=new m(0,0xffff0000),this.pawn=new m(65280,0xff0000),this.knight=new m(66,0x42000000),this.bishop=new m(36,0x24000000),this.rook=new m(129,0x81000000),this.queen=new m(8,0x8000000),this.king=new m(16,0x10000000)}static empty(){let e=new J;return e.clear(),e}clear(){for(let e of(this.occupied=m.empty(),this.promoted=m.empty(),w))this[e]=m.empty();for(let e of v)this[e]=m.empty()}clone(){let e=new J;for(let t of(e.occupied=this.occupied,e.promoted=this.promoted,w))e[t]=this[t];for(let t of v)e[t]=this[t];return e}getColor(e){return this.white.has(e)?"white":this.black.has(e)?"black":void 0}getRole(e){for(let t of v)if(this[t].has(e))return t}get(e){let t=this.getColor(e);if(t)return{color:t,role:this.getRole(e),promoted:this.promoted.has(e)}}take(e){let t=this.get(e);return t&&(this.occupied=this.occupied.without(e),this[t.color]=this[t.color].without(e),this[t.role]=this[t.role].without(e),t.promoted&&(this.promoted=this.promoted.without(e))),t}set(e,t){let r=this.take(e);return this.occupied=this.occupied.with(e),this[t.color]=this[t.color].with(e),this[t.role]=this[t.role].with(e),t.promoted&&(this.promoted=this.promoted.with(e)),r}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(let e of this.occupied)yield[e,this.get(e)]}pieces(e,t){return this[e].intersect(this[t])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,"king").singleSquare()}}(o=s||(s={})).Empty="ERR_EMPTY",o.OppositeCheck="ERR_OPPOSITE_CHECK",o.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",o.Kings="ERR_KINGS",o.Variant="ERR_VARIANT";class ee extends Error{}let et=(e,t,r,i)=>r[t].intersect(G(e,i).intersect(r.rooksAndQueens()).union(U(e,i).intersect(r.bishopsAndQueens())).union(B(e).intersect(r.knight)).union(L(e).intersect(r.king)).union(I(x(t),e).intersect(r.pawn)));class er{constructor(){}static default(){let e=new er;return e.castlingRights=m.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new m(14,0),h:new m(96,0)},black:{a:new m(0,0xe000000),h:new m(0,0x60000000)}},e}static empty(){let e=new er;return e.castlingRights=m.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:m.empty(),h:m.empty()},black:{a:m.empty(),h:m.empty()}},e}clone(){let e=new er;return e.castlingRights=this.castlingRights,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,t,r,i){let o=O(e,t),n=N(e,t);this.castlingRights=this.castlingRights.with(i),this.rook[e][t]=i,this.path[e][t]=Z(i,n).with(n).union(Z(r,o).with(o)).without(r).without(i)}static fromSetup(e){let t=er.empty(),r=e.castlingRights.intersect(e.board.rook);for(let i of w){let o=m.backrank(i),n=e.board.kingOf(i);if(!C(n)||!o.has(n))continue;let s=r.intersect(e.board[i]).intersect(o),a=s.first();C(a)&&a<n&&t.add(i,"a",n,a);let l=s.last();C(l)&&n<l&&t.add(i,"h",n,l)}return t}discardRook(e){if(this.castlingRights.has(e))for(let t of(this.castlingRights=this.castlingRights.without(e),w))for(let r of k)this.rook[t][r]===e&&(this.rook[t][r]=void 0)}discardColor(e){this.castlingRights=this.castlingRights.diff(m.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}}class ei{constructor(e){this.rules=e}reset(){this.board=J.default(),this.pockets=void 0,this.turn="white",this.castles=er.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=m.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=er.fromSetup(e),this.epSquare=en(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,t,r){return et(e,t,this.board,r)}playCaptureAt(e,t){this.halfmoves=0,"rook"===t.role&&this.castles.discardRook(e),this.pockets&&this.pockets[x(t.color)][t.promoted?"pawn":t.role]++}ctx(){let e=this.isVariantEnd(),t=this.board.kingOf(this.turn);if(!C(t))return{king:t,blockers:m.empty(),checkers:m.empty(),variantEnd:e,mustCapture:!1};let r=G(t,m.empty()).intersect(this.board.rooksAndQueens()).union(U(t,m.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[x(this.turn)]),i=m.empty();for(let e of r){let r=Z(t,e).intersect(this.board.occupied);r.moreThanOne()||(i=i.union(r))}let o=this.kingAttackers(t,x(this.turn),this.board.occupied);return{king:t,blockers:i,checkers:o,variantEnd:e,mustCapture:!1}}clone(){var e,t;let r=new this.constructor;return r.board=this.board.clone(),r.pockets=null===(e=this.pockets)||void 0===e?void 0:e.clone(),r.turn=this.turn,r.castles=this.castles.clone(),r.epSquare=this.epSquare,r.remainingChecks=null===(t=this.remainingChecks)||void 0===t?void 0:t.clone(),r.halfmoves=this.halfmoves,r.fullmoves=this.fullmoves,r}validate(){if(this.board.occupied.isEmpty())return l.err(new ee(s.Empty));if(2!==this.board.king.size()||!C(this.board.kingOf(this.turn)))return l.err(new ee(s.Kings));let e=this.board.kingOf(x(this.turn));return C(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?l.err(new ee(s.OppositeCheck)):m.backranks().intersects(this.board.pawn)?l.err(new ee(s.PawnsOnBackrank)):l.ok(void 0):l.err(new ee(s.Kings))}dropDests(e){return m.empty()}dests(e,t){let r,i;if((t=t||this.ctx()).variantEnd)return m.empty();let o=this.board.get(e);if(!o||o.color!==this.turn)return m.empty();if("pawn"===o.role){r=I(this.turn,e).intersect(this.board[x(this.turn)]);let o="white"===this.turn?8:-8,n=e+o;if(0<=n&&n<64&&!this.board.occupied.has(n)){r=r.with(n);let t="white"===this.turn?e<16:e>=48,i=n+o;t&&!this.board.occupied.has(i)&&(r=r.with(i))}C(this.epSquare)&&ea(this,e,t)&&(i=m.fromSquare(this.epSquare))}else r="bishop"===o.role?U(e,this.board.occupied):"knight"===o.role?B(e):"rook"===o.role?G(e,this.board.occupied):"queen"===o.role?Y(e,this.board.occupied):L(e);if(r=r.diff(this.board[this.turn]),C(t.king)){if("king"===o.role){let i=this.board.occupied.without(e);for(let e of r)this.kingAttackers(e,x(this.turn),i).nonEmpty()&&(r=r.without(e));return r.union(el(this,"a",t)).union(el(this,"h",t))}if(t.checkers.nonEmpty()){let e=t.checkers.singleSquare();if(!C(e))return m.empty();r=r.intersect(Z(e,t.king).with(e))}t.blockers.has(e)&&(r=r.intersect(X(e,t.king)))}return i&&(r=r.union(i)),r}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return!this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()&&(this.board[e].intersects(this.board.knight)?2>=this.board[e].size()&&this.board[x(e)].diff(this.board.king).diff(this.board.queen).isEmpty():!this.board[e].intersects(this.board.bishop)||(!this.board.bishop.intersects(m.darkSquares())||!this.board.bishop.intersects(m.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty())}toSetup(){var e,t;return{board:this.board.clone(),pockets:null===(e=this.pockets)||void 0===e?void 0:e.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:es(this),remainingChecks:null===(t=this.remainingChecks)||void 0===t?void 0:t.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return w.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){for(let t of(e=e||this.ctx(),this.board[this.turn]))if(this.dests(t,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,t){if(y(e))return!(!this.pockets||this.pockets[this.turn][e.role]<=0||"pawn"===e.role&&m.backranks().has(e.to))&&this.dropDests(t).has(e.to);{if("pawn"===e.promotion||"king"===e.promotion&&"antichess"!==this.rules||!!e.promotion!==(this.board.pawn.has(e.from)&&m.backranks().has(e.to)))return!1;let r=this.dests(e.from,t);return r.has(e.to)||r.has(ec(this,e).to)}}isCheck(){let e=this.board.kingOf(this.turn);return C(e)&&this.kingAttackers(e,x(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?!!e.variantEnd:!!this.isVariantEnd())||this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return!(e=e||this.ctx()).variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return!(e=e||this.ctx()).variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){return this.variantOutcome(e)||((e=e||this.ctx(),this.isCheckmate(e))?{winner:x(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();let t=new Map;if(e.variantEnd)return t;for(let r of this.board[this.turn])t.set(r,this.dests(r,e));return t}play(e){let t=this.turn,r=this.epSquare,i=eh(this,e);if(this.epSquare=void 0,this.halfmoves+=1,"black"===t&&(this.fullmoves+=1),this.turn=x(t),y(e))this.board.set(e.to,{role:e.role,color:t}),this.pockets&&this.pockets[t][e.role]--,"pawn"===e.role&&(this.halfmoves=0);else{let o;let n=this.board.take(e.from);if(!n)return;if("pawn"===n.role)this.halfmoves=0,e.to===r&&(o=this.board.take(e.to+("white"===t?-8:8))),16===Math.abs(e.from-e.to)&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(n.role=e.promotion,n.promoted=!!this.pockets);else if("rook"===n.role)this.castles.discardRook(e.from);else if("king"===n.role){if(i){let e=this.castles.rook[t][i];if(C(e)){let r=this.board.take(e);this.board.set(O(t,i),n),r&&this.board.set(N(t,i),r)}}this.castles.discardColor(t)}if(!i){let t=this.board.set(e.to,n)||o;t&&this.playCaptureAt(e.to,t)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[t]=Math.max(this.remainingChecks[t]-1,0))}}class eo extends ei{constructor(){super("chess")}static default(){let e=new this;return e.reset(),e}static fromSetup(e){let t=new this;return t.setupUnchecked(e),t.validate().map(e=>t)}clone(){return super.clone()}}let en=(e,t)=>{if(!C(t))return;let r="white"===e.turn?5:2,i="white"===e.turn?8:-8;if(S(t)!==r||e.board.occupied.has(t+i))return;let o=t-i;if(e.board.pawn.has(o)&&e.board[x(e.turn)].has(o))return t},es=e=>{if(!C(e.epSquare))return;let t=e.ctx();for(let r of e.board.pieces(e.turn,"pawn").intersect(I(x(e.turn),e.epSquare)))if(e.dests(r,t).has(e.epSquare))return e.epSquare},ea=(e,t,r)=>{if(!C(e.epSquare)||!I(e.turn,t).has(e.epSquare))return!1;if(!C(r.king))return!0;let i="white"===e.turn?8:-8,o=e.epSquare-i;return e.kingAttackers(r.king,x(e.turn),e.board.occupied.toggle(t).toggle(o).with(e.epSquare)).without(o).isEmpty()},el=(e,t,r)=>{if(!C(r.king)||r.checkers.nonEmpty())return m.empty();let i=e.castles.rook[e.turn][t];if(!C(i)||e.castles.path[e.turn][t].intersects(e.board.occupied))return m.empty();let o=O(e.turn,t),n=Z(r.king,o),s=e.board.occupied.without(r.king);for(let t of n)if(e.kingAttackers(t,x(e.turn),s).nonEmpty())return m.empty();let a=N(e.turn,t),l=e.board.occupied.toggle(r.king).toggle(i).toggle(a);return e.kingAttackers(o,x(e.turn),l).nonEmpty()?m.empty():m.fromSquare(i)},eh=(e,t)=>{if(y(t))return;let r=t.to-t.from;if((2===Math.abs(r)||e.board[e.turn].has(t.to))&&e.board.king.has(t.from))return r>0?"h":"a"},ec=(e,t)=>{let r=eh(e,t);if(!r)return t;let i=e.castles.rook[e.turn][r];return{from:t.from,to:C(i)?i:t.to}};var eu={};e(eu,"INITIAL_BOARD_FEN",function(){return em}),e(eu,"INITIAL_EPD",function(){return eg}),e(eu,"INITIAL_FEN",function(){return eb}),e(eu,"EMPTY_BOARD_FEN",function(){return ew}),e(eu,"EMPTY_EPD",function(){return ev}),e(eu,"EMPTY_FEN",function(){return ek}),e(eu,"InvalidFen",function(){return a}),e(eu,"FenError",function(){return ey}),e(eu,"parseBoardFen",function(){return eE}),e(eu,"parsePockets",function(){return eM}),e(eu,"parseCastlingFen",function(){return eP}),e(eu,"parseRemainingChecks",function(){return eq}),e(eu,"parseFen",function(){return eR}),e(eu,"parsePiece",function(){return eA}),e(eu,"makePiece",function(){return eO}),e(eu,"makeBoardFen",function(){return eN}),e(eu,"makePocket",function(){return eK}),e(eu,"makePockets",function(){return eT}),e(eu,"makeCastlingFen",function(){return eF}),e(eu,"makeRemainingChecks",function(){return eD}),e(eu,"makeFen",function(){return e_});class ed{constructor(){}static empty(){let e=new ed;for(let t of v)e[t]=0;return e}static fromBoard(e,t){let r=new ed;for(let i of v)r[i]=e.pieces(t,i).size();return r}clone(){let e=new ed;for(let t of v)e[t]=this[t];return e}equals(e){return v.every(t=>this[t]===e[t])}add(e){let t=new ed;for(let r of v)t[r]=this[r]+e[r];return t}subtract(e){let t=new ed;for(let r of v)t[r]=this[r]-e[r];return t}nonEmpty(){return v.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class ep{constructor(e,t){this.white=e,this.black=t}static empty(){return new ep(ed.empty(),ed.empty())}static fromBoard(e){return new ep(ed.fromBoard(e,"white"),ed.fromBoard(e,"black"))}clone(){return new ep(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new ep(this.white.add(e.white),this.black.add(e.black))}subtract(e){return new ep(this.white.subtract(e.white),this.black.subtract(e.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class ef{constructor(e,t){this.white=e,this.black=t}static default(){return new ef(3,3)}clone(){return new ef(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}}let em="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",eg=em+" w KQkq -",eb=eg+" 0 1",ew="8/8/8/8/8/8/8/8",ev=ew+" w - -",ek=ev+" 0 1";(n=a||(a={})).Fen="ERR_FEN",n.Board="ERR_BOARD",n.Pockets="ERR_POCKETS",n.Turn="ERR_TURN",n.Castling="ERR_CASTLING",n.EpSquare="ERR_EP_SQUARE",n.RemainingChecks="ERR_REMAINING_CHECKS",n.Halfmoves="ERR_HALFMOVES",n.Fullmoves="ERR_FULLMOVES";class ey extends Error{}let eC=(e,t,r)=>{let i=e.indexOf(t);for(;r-- >0&&-1!==i;)i=e.indexOf(t,i+t.length);return i},ex=e=>/^\d{1,4}$/.test(e)?parseInt(e,10):void 0,eS=e=>{let t=function(e){switch(e.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}},eE=e=>{let t=J.empty(),r=7,i=0;for(let o=0;o<e.length;o++){let n=e[o];if("/"===n&&8===i)i=0,r--;else{let s=parseInt(n,10);if(s>0)i+=s;else{if(i>=8||r<0)return l.err(new ey(a.Board));let s=i+8*r,h=eS(n);if(!h)return l.err(new ey(a.Board));"~"===e[o+1]&&(h.promoted=!0,o++),t.set(s,h),i++}}}return 0!==r||8!==i?l.err(new ey(a.Board)):l.ok(t)},eM=e=>{if(e.length>64)return l.err(new ey(a.Pockets));let t=ep.empty();for(let r of e){let e=eS(r);if(!e)return l.err(new ey(a.Pockets));t[e.color][e.role]++}return l.ok(t)},eP=(e,t)=>{let r=m.empty();if("-"===t)return l.ok(r);for(let i of t){let t=i.toLowerCase(),o=i===t?"black":"white",n="white"===o?0:7;if("a"<=t&&t<="h")r=r.with(M(t.charCodeAt(0)-97,n));else{if("k"!==t&&"q"!==t)return l.err(new ey(a.Castling));let i=e[o].intersect(m.backrank(o)).intersect(e.rook.union(e.king)),s="k"===t?i.last():i.first();r=r.with(C(s)&&e.rook.has(s)?s:M("k"===t?7:0,n))}}return w.some(e=>m.backrank(e).intersect(r).size()>2)?l.err(new ey(a.Castling)):l.ok(r)},eq=e=>{let t=e.split("+");if(3===t.length&&""===t[0]){let e=ex(t[1]),r=ex(t[2]);return!C(e)||e>3||!C(r)||r>3?l.err(new ey(a.RemainingChecks)):l.ok(new ef(3-e,3-r))}if(2!==t.length)return l.err(new ey(a.RemainingChecks));{let e=ex(t[0]),r=ex(t[1]);return!C(e)||e>3||!C(r)||r>3?l.err(new ey(a.RemainingChecks)):l.ok(new ef(e,r))}},eR=e=>{let t,r;let i=e.split(/[\s_]+/),o=i.shift(),n=l.ok(void 0);if(o.endsWith("]")){let e=o.indexOf("[");if(-1===e)return l.err(new ey(a.Fen));t=eE(o.slice(0,e)),n=eM(o.slice(e+1,-1))}else{let e=eC(o,"/",7);-1===e?t=eE(o):(t=eE(o.slice(0,e)),n=eM(o.slice(e+1)))}let s=i.shift();if(C(s)&&"w"!==s){if("b"!==s)return l.err(new ey(a.Turn));r="black"}else r="white";return t.chain(e=>{let t,o;let s=i.shift(),h=C(s)?eP(e,s):l.ok(m.empty()),c=i.shift();if(C(c)&&"-"!==c&&!C(t=q(c)))return l.err(new ey(a.EpSquare));let u=i.shift();C(u)&&u.includes("+")&&(o=eq(u),u=i.shift());let d=C(u)?ex(u):0;if(!C(d))return l.err(new ey(a.Halfmoves));let p=i.shift(),f=C(p)?ex(p):1;if(!C(f))return l.err(new ey(a.Fullmoves));let g=i.shift(),b=l.ok(void 0);if(C(g)){if(C(o))return l.err(new ey(a.RemainingChecks));b=eq(g)}else C(o)&&(b=o);return i.length>0?l.err(new ey(a.Fen)):n.chain(i=>h.chain(o=>b.map(n=>({board:e,pockets:i,turn:r,castlingRights:o,remainingChecks:n,epSquare:t,halfmoves:d,fullmoves:Math.max(1,f)}))))})},eA=e=>{if(!e)return;let t=eS(e[0]);if(t){if(2===e.length&&"~"===e[1])t.promoted=!0;else if(e.length>1)return;return t}},eO=e=>{let t=P(e.role);return"white"===e.color&&(t=t.toUpperCase()),e.promoted&&(t+="~"),t},eN=e=>{let t="",r=0;for(let i=7;i>=0;i--)for(let o=0;o<8;o++){let n=o+8*i,s=e.get(n);s?(r>0&&(t+=r,r=0),t+=eO(s)):r++,7===o&&(r>0&&(t+=r,r=0),0!==i&&(t+="/"))}return t},eK=e=>v.map(t=>P(t).repeat(e[t])).join(""),eT=e=>eK(e.white).toUpperCase()+eK(e.black),eF=(e,t)=>{let r="";for(let i of w){let o=m.backrank(i),n=e.kingOf(i);C(n)&&!o.has(n)&&(n=void 0);let s=e.pieces(i,"rook").intersect(o);for(let e of t.intersect(o).reversed())if(e===s.first()&&C(n)&&e<n)r+="white"===i?"Q":"q";else if(e===s.last()&&C(n)&&n<e)r+="white"===i?"K":"k";else{let t=g[E(e)];r+="white"===i?t.toUpperCase():t}}return r||"-"},eD=e=>`${e.white}+${e.black}`,e_=(e,t)=>[eN(e.board)+(e.pockets?`[${eT(e.pockets)}]`:""),e.turn[0],eF(e.board,e.castlingRights),C(e.epSquare)?R(e.epSquare):"-",...e.remainingChecks?[eD(e.remainingChecks)]:[],...(null==t?void 0:t.epd)?[]:[Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))]].join(" "),eL=["white","black"],eB=["a","b","c","d","e","f","g","h"],eI=["1","2","3","4","5","6","7","8"],e$=[...eI].reverse(),ez=Array.prototype.concat(...eB.map(e=>eI.map(t=>e+t))),eW=e=>ez[8*e[0]+e[1]],eH=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],ej=ez.map(eH),eV=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;let t=performance.now()-e;return e=void 0,t}}},eQ=e=>"white"===e?"black":"white",eU=(e,t)=>{let r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i},eG=(e,t)=>e.role===t.role&&e.color===t.color,eY=e=>(t,r)=>[(r?t[0]:7-t[0])*e.width/8,(r?7-t[1]:t[1])*e.height/8],eX=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},eZ=(e,t,r=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${r})`},eJ=(e,t)=>{e.style.visibility=t?"visible":"hidden"},e0=e=>{var t;return e.clientX||0===e.clientX?[e.clientX,e.clientY]:(null===(t=e.targetTouches)||void 0===t?void 0:t[0])?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},e1=e=>2===e.button,e3=(e,t)=>{let r=document.createElement(e);return t&&(r.className=t),r};function e2(e,t,r){let i=eH(e);return t||(i[0]=7-i[0],i[1]=7-i[1]),[r.left+r.width*i[0]/8+r.width/16,r.top+r.height*(7-i[1])/8+r.height/16]}let e5=(e,t)=>Math.abs(e-t),e8=e=>(t,r,i,o)=>2>e5(t,i)&&("white"===e?o===r+1||r<=1&&o===r+2&&t===i:o===r-1||r>=6&&o===r-2&&t===i),e6=(e,t,r,i)=>{let o=e5(e,r),n=e5(t,i);return 1===o&&2===n||2===o&&1===n},e4=(e,t,r,i)=>e5(e,r)===e5(t,i),e7=(e,t,r,i)=>e===r||t===i,e9=(e,t,r,i)=>e4(e,t,r,i)||e7(e,t,r,i),te=(e,t,r)=>(i,o,n,s)=>2>e5(i,n)&&2>e5(o,s)||r&&o===s&&o===("white"===e?0:7)&&(4===i&&(2===n&&t.includes(0)||6===n&&t.includes(7))||t.includes(n));function tt(e,t,r){let i=e.get(t);if(!i)return[];let o=eH(t),n=i.role,s="pawn"===n?e8(i.color):"knight"===n?e6:"bishop"===n?e4:"rook"===n?e7:"queen"===n?e9:te(i.color,function(e,t){let r="white"===t?"1":"8",i=[];for(let[o,n]of e)o[1]===r&&n.color===t&&"rook"===n.role&&i.push(eH(o)[0]);return i}(e,i.color),r);return ej.filter(e=>(o[0]!==e[0]||o[1]!==e[1])&&s(o[0],o[1],e[0],e[1])).map(eW)}function tr(e,...t){e&&setTimeout(()=>e(...t),1)}function ti(e){e.premovable.current&&(e.premovable.current=void 0,tr(e.premovable.events.unset))}function to(e){let t=e.predroppable;t.current&&(t.current=void 0,tr(t.events.unset))}function tn(e,t,r){let i=e.pieces.get(t),o=e.pieces.get(r);if(t===r||!i)return!1;let n=o&&o.color!==i.color?o:void 0;return r===e.selected&&td(e),tr(e.events.move,t,r,n),!function(e,t,r){if(!e.autoCastle)return!1;let i=e.pieces.get(t);if(!i||"king"!==i.role)return!1;let o=eH(t),n=eH(r);if(0!==o[1]&&7!==o[1]||o[1]!==n[1])return!1;4!==o[0]||e.pieces.has(r)||(6===n[0]?r=eW([7,n[1]]):2===n[0]&&(r=eW([0,n[1]])));let s=e.pieces.get(r);return!!s&&s.color===i.color&&"rook"===s.role&&(e.pieces.delete(t),e.pieces.delete(r),o[0]<n[0]?(e.pieces.set(eW([6,n[1]]),i),e.pieces.set(eW([5,n[1]]),s)):(e.pieces.set(eW([2,n[1]]),i),e.pieces.set(eW([3,n[1]]),s)),!0)}(e,t,r)&&(e.pieces.set(r,i),e.pieces.delete(t)),e.lastMove=[t,r],e.check=void 0,tr(e.events.change),n||!0}function ts(e,t,r,i){if(e.pieces.has(r)){if(!i)return!1;e.pieces.delete(r)}return tr(e.events.dropNewPiece,t,r),e.pieces.set(r,t),e.lastMove=[r],e.check=void 0,tr(e.events.change),e.movable.dests=void 0,e.turnColor=eQ(e.turnColor),!0}function ta(e,t,r){let i=tn(e,t,r);return i&&(e.movable.dests=void 0,e.turnColor=eQ(e.turnColor),e.animation.current=void 0),i}function tl(e,t,r){if(tf(e,t,r)){let i=ta(e,t,r);if(i){let o=e.hold.stop();td(e);let n={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return!0!==i&&(n.captured=i),tr(e.movable.events.after,t,r,n),!0}}else if(function(e,t,r){var i,o;let n=null!==(o=null===(i=e.premovable.customDests)||void 0===i?void 0:i.get(t))&&void 0!==o?o:tt(e.pieces,t,e.premovable.castle);return t!==r&&tm(e,t)&&n.includes(r)}(e,t,r)){var i;return i={ctrlKey:e.stats.ctrlKey},to(e),e.premovable.current=[t,r],tr(e.premovable.events.set,t,r,i),td(e),!0}return td(e),!1}function th(e,t,r,i){let o=e.pieces.get(t);if(o&&(function(e,t,r){let i=e.pieces.get(t);return!!i&&(t===r||!e.pieces.has(r))&&("both"===e.movable.color||e.movable.color===i.color&&e.turnColor===i.color)}(e,t,r)||i))e.pieces.delete(t),ts(e,o,r,i),tr(e.movable.events.afterNewPiece,o.role,r,{premove:!1,predrop:!1});else if(o&&function(e,t,r){let i=e.pieces.get(t),o=e.pieces.get(r);return!!i&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==i.role||"1"!==r[1]&&"8"!==r[1])&&e.movable.color===i.color&&e.turnColor!==i.color}(e,t,r)){var n;n=o.role,ti(e),e.predroppable.current={role:n,key:r},tr(e.predroppable.events.set,n,r)}else ti(e),to(e);e.pieces.delete(t),td(e)}function tc(e,t,r){if(tr(e.events.select,t),e.selected){if(e.selected!==t||e.draggable.enabled){if((e.selectable.enabled||r)&&e.selected!==t&&tl(e,e.selected,t)){e.stats.dragged=!1;return}}else{td(e),e.hold.cancel();return}}(e.selectable.enabled||e.draggable.enabled)&&(tp(e,t)||tm(e,t))&&(tu(e,t),e.hold.start())}function tu(e,t){e.selected=t,tm(e,t)?e.premovable.customDests||(e.premovable.dests=tt(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function td(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function tp(e,t){let r=e.pieces.get(t);return!!r&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}let tf=(e,t,r)=>{var i,o;return t!==r&&tp(e,t)&&(e.movable.free||!!(null===(o=null===(i=e.movable.dests)||void 0===i?void 0:i.get(t))||void 0===o?void 0:o.includes(r)))};function tm(e,t){let r=e.pieces.get(t);return!!r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function tg(e){let t=e.premovable.current;if(!t)return!1;let r=t[0],i=t[1],o=!1;if(tf(e,r,i)){let t=ta(e,r,i);if(t){let n={premove:!0};!0!==t&&(n.captured=t),tr(e.movable.events.after,r,i,n),o=!0}}return ti(e),o}function tb(e){ti(e),to(e),td(e)}function tw(e){e.movable.color=e.movable.dests=e.animation.current=void 0,tb(e)}function tv(e,t,r){let i=Math.floor(8*(e[0]-r.left)/r.width);t||(i=7-i);let o=7-Math.floor(8*(e[1]-r.top)/r.height);return t||(o=7-o),i>=0&&i<8&&o>=0&&o<8?eW([i,o]):void 0}let tk=e=>"white"===e.orientation,ty="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",tC={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},tx={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function tS(e){"start"===e&&(e=ty);let t=new Map,r=7,i=0;for(let o of e)switch(o){case" ":case"[":return t;case"/":if(--r<0)return t;i=0;break;case"~":{let e=t.get(eW([i-1,r]));e&&(e.promoted=!0);break}default:{let e=o.charCodeAt(0);if(e<57)i+=e-48;else{let e=o.toLowerCase();t.set(eW([i,r]),{role:tC[e],color:o===e?"black":"white"}),++i}}}return t}function tE(e,t){t.animation&&(tP(e.animation,t.animation),70>(e.animation.duration||0)&&(e.animation.enabled=!1))}function tM(e,t){var r,i,o;if((null===(r=t.movable)||void 0===r?void 0:r.dests)&&(e.movable.dests=void 0),(null===(i=t.drawable)||void 0===i?void 0:i.autoShapes)&&(e.drawable.autoShapes=[]),tP(e,t),t.fen&&(e.pieces=tS(t.fen),e.drawable.shapes=(null===(o=t.drawable)||void 0===o?void 0:o.shapes)||[]),"check"in t&&function(e,t){if(e.check=void 0,!0===t&&(t=e.turnColor),t)for(let[r,i]of e.pieces)"king"===i.role&&i.color===t&&(e.check=r)}(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&tu(e,e.selected),tE(e,t),!e.movable.rookCastle&&e.movable.dests){let t="white"===e.movable.color?"1":"8",r="e"+t,i=e.movable.dests.get(r),o=e.pieces.get(r);if(!i||!o||"king"!==o.role)return;e.movable.dests.set(r,i.filter(e=>!(e==="a"+t&&i.includes("c"+t))&&!(e==="h"+t&&i.includes("g"+t))))}}function tP(e,t){for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)&&tq(e[r])&&tq(t[r])?tP(e[r],t[r]):e[r]=t[r])}function tq(e){if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}let tR=(e,t)=>t.animation.enabled?function(e,t){let r=new Map(t.pieces),i=e(t),o=function(e,t){let r,i,o;let n=new Map,s=[],a=new Map,l=[],h=[],c=new Map;for(let[t,r]of e)c.set(t,tO(t,r));for(let e of ez)r=t.pieces.get(e),i=c.get(e),r?i?eG(r,i.piece)||(l.push(i),h.push(tO(e,r))):h.push(tO(e,r)):i&&l.push(i);for(let e of h)(i=tN(e,l.filter(t=>eG(e.piece,t.piece))))&&(o=[i.pos[0]-e.pos[0],i.pos[1]-e.pos[1]],n.set(e.key,o.concat(o)),s.push(i.key));for(let e of l)s.includes(e.key)||a.set(e.key,e.piece);return{anims:n,fadings:a}}(r,t);if(o.anims.size||o.fadings.size){let e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:o},e||function e(t,r){let i=t.animation.current;if(void 0===i){t.dom.destroyed||t.dom.redrawNow();return}let o=1-(r-i.start)*i.frequency;if(o<=0)t.animation.current=void 0,t.dom.redrawNow();else{let r=tK(o);for(let e of i.plan.anims.values())e[2]=e[0]*r,e[3]=e[1]*r;t.dom.redrawNow(!0),requestAnimationFrame((r=performance.now())=>e(t,r))}}(t,performance.now())}else t.dom.redraw();return i}(e,t):tA(e,t);function tA(e,t){let r=e(t);return t.dom.redraw(),r}let tO=(e,t)=>({key:e,pos:eH(e),piece:t}),tN=(e,t)=>t.sort((t,r)=>eU(e.pos,t.pos)-eU(e.pos,r.pos))[0],tK=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,tT=["green","red","blue","yellow"];function tF(e,t){e.drawable.current&&(e.drawable.current.pos=e0(t))}function tD(e){let t=e.drawable.current;t&&(t.mouseSq&&function(e,t){let r=e=>e.orig===t.orig&&e.dest===t.dest,i=e.shapes.find(r);i&&(e.shapes=e.shapes.filter(e=>!r(e))),i&&i.brush===t.brush||e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),tL(e)}(e.drawable,t),t_(e))}function t_(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function tL(e){e.onChange&&e.onChange(e.shapes)}function tB(e){requestAnimationFrame(()=>{var t;let r=e.draggable.current;if(!r)return;(null===(t=e.animation.current)||void 0===t?void 0:t.plan.anims.has(r.orig))&&(e.animation.current=void 0);let i=e.pieces.get(r.orig);if(i&&eG(i,r.piece)){if(!r.started&&eU(r.pos,r.origPos)>=Math.pow(e.draggable.distance,2)&&(r.started=!0),r.started){if("function"==typeof r.element){let e=r.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),r.element=e}let t=e.dom.bounds();eX(r.element,[r.pos[0]-t.left-t.width/16,r.pos[1]-t.top-t.height/16]),r.keyHasChanged||(r.keyHasChanged=r.orig!==tv(r.pos,tk(e),t))}}else tz(e);tB(e)})}function tI(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=e0(t))}function t$(e,t){let r=e.draggable.current;if(!r)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&r.originTarget!==t.target&&!r.newPiece){e.draggable.current=void 0;return}ti(e),to(e);let i=tv(e0(t)||r.pos,tk(e),e.dom.bounds());i&&r.started&&r.orig!==i?r.newPiece?th(e,r.orig,i,r.force):(e.stats.ctrlKey=t.ctrlKey,tl(e,r.orig,i)&&(e.stats.dragged=!0)):r.newPiece?e.pieces.delete(r.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(r.orig),tr(e.events.change)),(r.orig===r.previouslySelected||r.keyHasChanged)&&(r.orig===i||!i)?td(e):e.selectable.enabled||td(e),tW(e),e.draggable.current=void 0,e.dom.redraw()}function tz(e){let t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,td(e),tW(e),e.dom.redraw())}function tW(e){let t=e.dom.elements;t.ghost&&eJ(t.ghost,!1)}function tH(e,t){let r=e.dom.elements.board.firstChild;for(;r;){if(r.cgKey===t&&"PIECE"===r.tagName)return r;r=r.nextSibling}}function tj(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}let tV={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function tQ({orig:e,dest:t,brush:r,piece:i,modifiers:o,customSvg:n,label:s},a,l,h){var c,u;return[h.width,h.height,l,e,t,r,a&&"-",i&&[i.color,i.role,i.scale].filter(e=>e).join(","),o&&[o.lineWidth,o.hilite&&"*"].filter(e=>e).join(","),n&&`custom-${tU(n.html)},${null!==(u=null===(c=n.center)||void 0===c?void 0:c[0])&&void 0!==u?u:"o"}`,s&&`label-${tU(s.text)}`].filter(e=>e).join(",")}function tU(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)>>>0;return t.toString()}function tG(e){return["#ffffff","#fff","white"].includes(e.color)?tV.hilitePrimary:tV.hiliteWhite}function tY(e,t){return"white"===t?e:[7-e[0],7-e[1]]}function tX(e,t){return!0===(e&&t.has(e)&&t.get(e).size>1)}function tZ(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function tJ(e,t){for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.setAttribute(r,t[r]);return e}function t0(e,t){return t?{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(e=>e).join("")}:e}function t1(e,t){return(e.opacity||1)*(t?.9:1)}function t3(e,t){let r=Math.min(1,t.width/t.height),i=Math.min(1,t.height/t.width);return[(e[0]-3.5)*r,(3.5-e[1])*i]}function t2(e,t,r=!0){let i=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return r?(Math.round(8*i/Math.PI)+16)%16:i}function t5(e,t,r){let i=Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((e,t)=>e+t*t,0)),o=t2(e,t,!1);if(r&&(i-=33/64,r.size>1)){i-=10/64;let o=t2(e,t);(r.has((o+1)%16)||r.has((o+15)%16))&&1&o&&(i-=.4)}return[e[0]-Math.cos(o)*i,e[1]-Math.sin(o)*i].map(e=>e+.5)}function t8(e,t){let r;let i=e3("coords",t);for(let t of e)(r=e3("coord")).textContent=t,i.appendChild(r);return i}function t6(e,t,r,i){return e.addEventListener(t,r,i),()=>e.removeEventListener(t,r,i)}let t4=e=>t=>{e.draggable.current?tz(e):e.drawable.current?t_(e):t.shiftKey||e1(t)?e.drawable.enabled&&function(e,t){var r;if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?td(e):tb(e);let i=e0(t),o=tv(i,tk(e),e.dom.bounds());o&&(e.drawable.current={orig:o,pos:i,brush:tT[((t.shiftKey||t.ctrlKey)&&e1(t)?1:0)+(t.altKey||t.metaKey||(null===(r=t.getModifierState)||void 0===r?void 0:r.call(t,"AltGraph"))?2:0)],snapToValidMove:e.drawable.defaultSnapToValidMove},function e(t){requestAnimationFrame(()=>{let r=t.drawable.current;if(r){let i=tv(r.pos,tk(t),t.dom.bounds());i||(r.snapToValidMove=!1);let o=r.snapToValidMove?function(e,t,r,i){let o=eH(e),n=ej.filter(e=>e9(o[0],o[1],e[0],e[1])||e6(o[0],o[1],e[0],e[1])),s=n.map(e=>e2(eW(e),r,i)).map(e=>eU(t,e)),[,a]=s.reduce((e,t,r)=>e[0]<t?e:[t,r],[s[0],0]);return eW(n[a])}(r.orig,r.pos,tk(t),t.dom.bounds()):i;o!==r.mouseSq&&(r.mouseSq=o,r.dest=o!==r.orig?o:void 0,t.dom.redrawNow()),e(t)}})}(e))}(e,t):e.viewOnly||(e.dropmode.active?function(e,t){if(!e.dropmode.active)return;ti(e),to(e);let r=e.dropmode.piece;if(r){e.pieces.set("a0",r);let i=e0(t),o=i&&tv(i,tk(e),e.dom.bounds());o&&th(e,"a0",o)}e.dom.redraw()}(e,t):function(e,t){if(!(e.trustAllEvents||t.isTrusted)||void 0!==t.buttons&&t.buttons>1||t.touches&&t.touches.length>1)return;let r=e.dom.bounds(),i=e0(t),o=tv(i,tk(e),r);if(!o)return;let n=e.pieces.get(o),s=e.selected;if(!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!n||n.color!==e.turnColor)&&e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),tL(e.drawable)),!1!==t.cancelable&&(!t.touches||e.blockTouchScroll||n||s||function(e,t){let r=tk(e),i=e.dom.bounds(),o=Math.pow(i.width/8,2);for(let n of e.pieces.keys())if(eU(e2(n,r,i),t)<=o)return!0;return!1}(e,i)))t.preventDefault();else if(t.touches)return;let a=!!e.premovable.current,l=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&tf(e,e.selected,o)?tR(e=>tc(e,o),e):tc(e,o);let h=e.selected===o,c=tH(e,o);if(n&&c&&h&&function(e,t){let r=e.pieces.get(t);return!!r&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))}(e,o)){e.draggable.current={orig:o,piece:n,origPos:i,pos:i,started:e.draggable.autoDistance&&e.stats.dragged,element:c,previouslySelected:s,originTarget:t.target,keyHasChanged:!1},c.cgDragging=!0,c.classList.add("dragging");let a=e.dom.elements.ghost;a&&(a.className=`ghost ${n.color} ${n.role}`,eX(a,eY(r)(eH(o),tk(e))),eJ(a,!0)),tB(e)}else a&&ti(e),l&&to(e);e.dom.redraw()}(e,t))},t7=(e,t,r)=>i=>{e.drawable.current?e.drawable.enabled&&r(e,i):e.viewOnly||t(e,i)};function t9(e){var t,r;let i=e.dom.elements.wrap.getBoundingClientRect(),o=e.dom.elements.container,n=i.height/i.width,s=8*Math.floor(i.width*window.devicePixelRatio/8)/window.devicePixelRatio,a=s*n;o.style.width=s+"px",o.style.height=a+"px",e.dom.bounds.clear(),null===(t=e.addDimensionsCssVarsTo)||void 0===t||t.style.setProperty("---cg-width",s+"px"),null===(r=e.addDimensionsCssVarsTo)||void 0===r||r.style.setProperty("---cg-height",a+"px")}let re=e=>"PIECE"===e.tagName,rt=e=>"SQUARE"===e.tagName;function rr(e,t){for(let r of t)e.dom.elements.board.removeChild(r)}function ri(e,t){let r=e[1];return`${t?10-r:3+r}`}let ro=e=>`${e.color} ${e.role}`;function rn(e,t,r){let i=e.get(t);i?e.set(t,`${i} ${r}`):e.set(t,r)}function rs(e,t,r){let i=e.get(t);i?i.push(r):e.set(t,[r])}let ra=e=>{var t,r,i;return[e.orig,null===(t=e.piece)||void 0===t?void 0:t.role,null===(r=e.piece)||void 0===r?void 0:r.color,null===(i=e.piece)||void 0===i?void 0:i.scale].join(",")},rl=e=>({value:[...e.board.white].flatMap(t=>[...e.dests(t,e.ctx())].map(e=>({from:t,to:e}))).length-[...e.board.black].flatMap(t=>[...e.dests(t,e.ctx())].map(e=>({from:t,to:e}))).length,certain:!1}),rh=(e,t,r=!0)=>(t.value-e.value)*(r?1:-1),rc=(e,t)=>{if(e.isStalemate())return{value:0,certain:!0};if(e.isCheckmate())return{value:"white"===e.turn?-1:1,certain:!0};if(0===t)return rl(e);let r=[...e.board[e.turn]].flatMap(t=>[...e.dests(t,e.ctx())].map(e=>({from:t,to:e}))).map(r=>{let i=e.clone();return i.play(r),rd(i,t-1)}).sort((t,r)=>rh(t,r,"white"===e.turn))[0];return{value:r.value,certain:r.certain}},ru={},rd=(e,t=2)=>{let r=eu.makeBoardFen(e.board);if(ru[r])return ru[r];let i=rc(e,t);return i.certain&&(ru[r]=i),i},rp=e=>{let t=[...e.board[e.turn]].flatMap(t=>[...e.dests(t,e.ctx())].map(e=>({from:t,to:e}))).map(t=>{let r=e.clone();return r.play(t),{move:t,evaluation:rd(r)}}).sort((t,r)=>rh(t.evaluation,r.evaluation,"white"===e.turn)),r=t[0],i=t.filter(({evaluation:e})=>e.value===r.evaluation.value).map(({move:e})=>e);return i[Math.floor(Math.random()*i.length)]},rf=document.querySelector("#to-play"),rm=document.querySelector("#fen-form"),rg=document.querySelector("#fen"),rb=document.querySelector("#best-move"),rw=eo.default(),rv=function(e,t){let r={pieces:tS(ty),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:eV()};function i(){let t;let i="dom"in r?r.dom.unbind:void 0,o=function(e,t){let r,i,o,n;for(let r of(e.innerHTML="",e.classList.add("cg-wrap"),eL))e.classList.toggle("orientation-"+r,t.orientation===r);e.classList.toggle("manipulable",!t.viewOnly);let s=e3("cg-container");e.appendChild(s);let a=e3("cg-board");if(s.appendChild(a),t.drawable.visible&&((r=tJ(tZ("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"})).appendChild(function(){let e=tZ("defs"),t=tJ(tZ("filter"),{id:"cg-filter-blur"});return t.appendChild(tJ(tZ("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}()),r.appendChild(tZ("g")),(i=tJ(tZ("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"})).appendChild(tZ("g")),o=e3("cg-auto-pieces"),s.appendChild(r),s.appendChild(i),s.appendChild(o)),t.coordinates){let e="black"===t.orientation?" black":"",r="left"===t.ranksPosition?" left":"";if(t.coordinatesOnSquares){let i="white"===t.orientation?e=>e+1:e=>8-e;eB.forEach((t,o)=>s.appendChild(t8(eI.map(e=>t+e),"squares rank"+i(o)+e+r)))}else s.appendChild(t8(eI,"ranks"+e+r)),s.appendChild(t8(eB,"files"+e))}return t.draggable.enabled&&t.draggable.showGhost&&(eJ(n=e3("piece","ghost"),!1),s.appendChild(n)),{board:a,container:s,wrap:e,ghost:n,svg:r,customSvg:i,autoPieces:o}}(e,r),n=function(e){let t;let r=()=>(void 0===t&&(t=e()),t);return r.clear=()=>{t=void 0},r}(()=>o.board.getBoundingClientRect()),s=e=>{if(!function(e){let t,r,i,o,n,s,a,l,h,c;let u=tk(e),d=eY(e.dom.bounds()),p=e.dom.elements.board,f=e.pieces,m=e.animation.current,g=m?m.plan.anims:new Map,b=m?m.plan.fadings:new Map,w=e.draggable.current,v=function(e){var t,r,i;let o=new Map;if(e.lastMove&&e.highlight.lastMove)for(let t of e.lastMove)rn(o,t,"last-move");if(e.check&&e.highlight.check&&rn(o,e.check,"check"),e.selected&&(rn(o,e.selected,"selected"),e.movable.showDests)){let n=null===(t=e.movable.dests)||void 0===t?void 0:t.get(e.selected);if(n)for(let t of n)rn(o,t,"move-dest"+(e.pieces.has(t)?" oc":""));let s=null!==(i=null===(r=e.premovable.customDests)||void 0===r?void 0:r.get(e.selected))&&void 0!==i?i:e.premovable.dests;if(s)for(let t of s)rn(o,t,"premove-dest"+(e.pieces.has(t)?" oc":""))}let n=e.premovable.current;if(n)for(let e of n)rn(o,e,"current-premove");else e.predroppable.current&&rn(o,e.predroppable.current.key,"current-premove");let s=e.exploding;if(s)for(let e of s.keys)rn(o,e,"exploding"+s.stage);return e.highlight.custom&&e.highlight.custom.forEach((e,t)=>{rn(o,t,e)}),o}(e),k=new Set,y=new Set,C=new Map,x=new Map;for(r=p.firstChild;r;){if(t=r.cgKey,re(r)){if(i=f.get(t),n=g.get(t),s=b.get(t),o=r.cgPiece,r.cgDragging&&(!w||w.orig!==t)&&(r.classList.remove("dragging"),eX(r,d(eH(t),u)),r.cgDragging=!1),!s&&r.cgFading&&(r.cgFading=!1,r.classList.remove("fading")),i){if(n&&r.cgAnimating&&o===ro(i)){let e=eH(t);e[0]+=n[2],e[1]+=n[3],r.classList.add("anim"),eX(r,d(e,u))}else r.cgAnimating&&(r.cgAnimating=!1,r.classList.remove("anim"),eX(r,d(eH(t),u)),e.addPieceZIndex&&(r.style.zIndex=ri(eH(t),u)));o!==ro(i)||s&&r.cgFading?s&&o===ro(s)?(r.classList.add("fading"),r.cgFading=!0):rs(C,o,r):k.add(t)}else rs(C,o,r)}else if(rt(r)){let e=r.className;v.get(t)===e?y.add(t):rs(x,e,r)}r=r.nextSibling}for(let[e,t]of v)if(!y.has(e)){c=(h=x.get(t))&&h.pop();let r=d(eH(e),u);if(c)c.cgKey=e,eX(c,r);else{let i=e3("square",t);i.cgKey=e,eX(i,r),p.insertBefore(i,p.firstChild)}}for(let[t,r]of f)if(n=g.get(t),!k.has(t)){if(l=(a=C.get(ro(r)))&&a.pop()){l.cgKey=t,l.cgFading&&(l.classList.remove("fading"),l.cgFading=!1);let r=eH(t);e.addPieceZIndex&&(l.style.zIndex=ri(r,u)),n&&(l.cgAnimating=!0,l.classList.add("anim"),r[0]+=n[2],r[1]+=n[3]),eX(l,d(r,u))}else{let i=ro(r),o=e3("piece",i),s=eH(t);o.cgPiece=i,o.cgKey=t,n&&(o.cgAnimating=!0,s[0]+=n[2],s[1]+=n[3]),eX(o,d(s,u)),e.addPieceZIndex&&(o.style.zIndex=ri(s,u)),p.appendChild(o)}}for(let t of C.values())rr(e,t);for(let t of x.values())rr(e,t)}(l),o.autoPieces){var t;t=o.autoPieces,function(e,t,r){let i=new Map,o=[];for(let t of e)i.set(t.hash,!1);let n=t.firstElementChild,s;for(;n;)s=n.getAttribute("cgHash"),i.has(s)?i.set(s,!0):o.push(n),n=n.nextElementSibling;for(let e of o)t.removeChild(e);for(let o of e)i.get(o.hash)||t.appendChild(r(o))}(l.drawable.autoShapes.filter(e=>e.piece).map(e=>({shape:e,hash:ra(e),current:!1})),t,e=>(function(e,{shape:t,hash:r},i){var o,n,s;let a=t.orig,l=null===(o=t.piece)||void 0===o?void 0:o.role,h=null===(n=t.piece)||void 0===n?void 0:n.color,c=null===(s=t.piece)||void 0===s?void 0:s.scale,u=e3("piece",`${l} ${h}`);return u.setAttribute("cgHash",r),u.cgKey=a,u.cgScale=c,eZ(u,eY(i)(eH(a),tk(e)),c),u})(l,e,l.dom.bounds()))}!e&&o.svg&&function(e,t,r){var i;let o=e.drawable,n=o.current,s=n&&n.mouseSq?n:void 0,a=new Map,l=e.dom.bounds(),h=o.autoShapes.filter(e=>!e.piece);for(let t of o.shapes.concat(h).concat(s?[s]:[])){if(!t.dest)continue;let r=null!==(i=a.get(t.dest))&&void 0!==i?i:new Set,o=t3(tY(eH(t.orig),e.orientation),l),n=t3(tY(eH(t.dest),e.orientation),l);r.add(t2(o,n)),a.set(t.dest,r)}let c=o.shapes.concat(h).map(e=>({shape:e,current:!1,hash:tQ(e,tX(e.dest,a),!1,l)}));s&&c.push({shape:s,current:!0,hash:tQ(s,tX(s.dest,a),!0,l)});let u=c.map(e=>e.hash).join(";");u!==e.drawable.prevSvgHash&&(e.drawable.prevSvgHash=u,function(e,t,r){var i;let o;let n=new Map;for(let r of t.filter(e=>e.shape.dest&&e.shape.brush))o=t0(e.brushes[r.shape.brush],r.shape.modifiers),(null===(i=r.shape.modifiers)||void 0===i?void 0:i.hilite)&&n.set(tG(o).key,tG(o)),n.set(o.key,o);let s=new Set,a=r.firstElementChild;for(;a;)s.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(let[e,t]of n.entries())s.has(e)||r.appendChild(function(e){let t=tJ(tZ("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(tJ(tZ("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}(t))}(o,c,t.querySelector("defs")),function(e,t,r,i){let o=new Map;for(let t of e)o.set(t.hash,!1);for(let e of[t,r]){let t=[],r=e.firstElementChild,i;for(;r;)i=r.getAttribute("cgHash"),o.has(i)?o.set(i,!0):t.push(r),r=r.nextElementSibling;for(let r of t)e.removeChild(r)}for(let n of e.filter(e=>!o.get(e.hash)))for(let e of i(n))e.isCustom?r.appendChild(e.el):t.appendChild(e.el)}(c,t.querySelector("g"),r.querySelector("g"),t=>(function(e,{shape:t,current:r,hash:i},o,n,s){var a,l;let h=t3(tY(eH(t.orig),e.orientation),s),c=t.dest?t3(tY(eH(t.dest),e.orientation),s):h,u=t.brush&&t0(o[t.brush],t.modifiers),d=n.get(t.dest),p=[];if(u){let e=tJ(tZ("g"),{cgHash:i});p.push({el:e}),h[0]!==c[0]||h[1]!==c[1]?e.appendChild(function(e,t,r,i,o,n){var s;function a(s){var a;let l=(n&&!o?20:10)/64,h=i[0]-r[0],c=Math.atan2(i[1]-r[1],h),u=Math.cos(c)*l,d=Math.sin(c)*l;return tJ(tZ("line"),{stroke:s?tG(t).color:t.color,"stroke-width":(t.lineWidth||10)*(o?.85:1)/64+(s?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${s?tG(t).key:t.key})`,opacity:(null===(a=e.modifiers)||void 0===a?void 0:a.hilite)?1:t1(t,o),x1:r[0],y1:r[1],x2:i[0]-u,y2:i[1]-d})}if(!(null===(s=e.modifiers)||void 0===s?void 0:s.hilite))return a(!1);let l=tZ("g"),h=tJ(tZ("g"),{filter:"url(#cg-filter-blur)"});return h.appendChild(function(e,t){let r={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return tJ(tZ("rect"),{x:r.from[0],y:r.from[1],width:r.to[0]-r.from[0],height:r.to[1]-r.from[1],fill:"none",stroke:"none"})}(r,i)),h.appendChild(a(!0)),l.appendChild(h),l.appendChild(a(!1)),l}(t,u,h,c,r,tX(t.dest,n))):e.appendChild(function(e,t,r,i){let o=[3/64,4/64],n=(i.width+i.height)/(4*Math.max(i.width,i.height));return tJ(tZ("circle"),{stroke:e.color,"stroke-width":o[r?0:1],fill:"none",opacity:t1(e,r),cx:t[0],cy:t[1],r:n-o[1]/2})}(o[t.brush],h,r,s))}if(t.label){let e=t.label;null!==(a=e.fill)&&void 0!==a||(e.fill=t.brush&&o[t.brush].color);let r=t.brush?void 0:"tr";p.push({el:function(e,t,r,i,o,n){var s;let a=.4*.75**e.text.length,l=t5(r,i,o),h="tr"===n?.4:0,c=tJ(tZ("g"),{transform:`translate(${l[0]+h},${l[1]-h})`,cgHash:t});c.appendChild(tJ(tZ("circle"),{r:.2,"fill-opacity":n?1:.8,"stroke-opacity":n?1:.7,"stroke-width":.03,fill:null!==(s=e.fill)&&void 0!==s?s:"#666",stroke:"white"}));let u=tJ(tZ("text"),{"font-size":a,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return u.innerHTML=e.text,c.appendChild(u),c}(e,i,h,c,d,r),isCustom:!0})}if(t.customSvg){let e=null!==(l=t.customSvg.center)&&void 0!==l?l:"orig",[r,o]="label"===e?t5(h,c,d).map(e=>e-.5):"dest"===e?c:h,n=tJ(tZ("g"),{transform:`translate(${r},${o})`,cgHash:i});n.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,p.push({el:n,isCustom:!0})}return p})(e,t,o.brushes,a,l)))}(l,o.svg,o.customSvg)},a=()=>{t9(l),function(e){let t=tk(e),r=eY(e.dom.bounds()),i=e.dom.elements.board.firstChild;for(;i;)(re(i)&&!i.cgAnimating||rt(i))&&eX(i,r(eH(i.cgKey),t)),i=i.nextSibling}(l),o.autoPieces&&function(e){var t;let r=tk(e),i=eY(e.dom.bounds()),o=null===(t=e.dom.elements.autoPieces)||void 0===t?void 0:t.firstChild;for(;o;)eZ(o,i(eH(o.cgKey),r),o.cgScale),o=o.nextSibling}(l)},l=r;return l.dom={elements:o,bounds:n,redraw:(t=!1,()=>{t||(t=!0,requestAnimationFrame(()=>{s(),t=!1}))}),redrawNow:s,unbind:i},l.drawable.prevSvgHash="",t9(l),s(!1),!function(e,t){let r=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&r.addEventListener("contextmenu",e=>e.preventDefault()),e.viewOnly)return;let i=t4(e);r.addEventListener("touchstart",i,{passive:!1}),r.addEventListener("mousedown",i,{passive:!1})}(l,a),i||(l.dom.unbind=function(e,t){let r=[];if("ResizeObserver"in window||r.push(t6(document.body,"chessground.resize",t)),!e.viewOnly){let t=t7(e,tI,tF),i=t7(e,t$,tD);for(let e of["touchmove","mousemove"])r.push(t6(document,e,t));for(let e of["touchend","mouseup"])r.push(t6(document,e,i));let o=()=>e.dom.bounds.clear();r.push(t6(document,"scroll",o,{capture:!0,passive:!0})),r.push(t6(window,"resize",o,{passive:!0}))}return()=>r.forEach(e=>e())}(l,a)),l.events.insert&&l.events.insert(o),l}return tM(r,t||{}),function(e,t){function r(){e.orientation=eQ(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0,t()}return{set(t){t.orientation&&t.orientation!==e.orientation&&r(),tE(e,t),(t.fen?tR:tA)(e=>tM(e,t),e)},state:e,getFen:()=>{var t;return t=e.pieces,e$.map(e=>eB.map(r=>{let i=t.get(r+e);if(!i)return"1";{let e=tx[i.role];return"white"===i.color&&(e=e.toUpperCase()),i.promoted&&(e+="~"),e}}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())},toggleOrientation:r,setPieces(t){tR(e=>(function(e,t){for(let[r,i]of t)i?e.pieces.set(r,i):e.pieces.delete(r)})(e,t),e)},selectSquare(t,r){t?tR(e=>tc(e,t,r),e):e.selected&&(td(e),e.dom.redraw())},move(t,r){tR(e=>tn(e,t,r),e)},newPiece(t,r){tR(e=>ts(e,t,r),e)},playPremove(){if(e.premovable.current){if(tR(tg,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){let r=function(e,t){let r=e.predroppable.current,i=!1;if(!r)return!1;if(t(r)){let t={role:r.role,color:e.movable.color};ts(e,t,r.key)&&(tr(e.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),i=!0)}return to(e),i}(e,t);return e.dom.redraw(),r}return!1},cancelPremove(){tA(ti,e)},cancelPredrop(){tA(to,e)},cancelMove(){tA(e=>{tb(e),tz(e)},e)},stop(){tA(e=>{tw(e),tz(e)},e)},explode(t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{tj(e,2),setTimeout(()=>tj(e,void 0),120)},120)},setAutoShapes(t){tA(e=>e.drawable.autoShapes=t,e)},setShapes(t){tA(e=>e.drawable.shapes=t,e)},getKeyAtDomPos:t=>tv(t,tk(e),e.dom.bounds()),redrawAll:t,dragNewPiece(t,r,i){!function(e,t,r,i){e.pieces.set("a0",t),e.dom.redraw();let o=e0(r);e.draggable.current={orig:"a0",piece:t,origPos:o,pos:o,started:!0,element:()=>tH(e,"a0"),originTarget:r.target,newPiece:!0,force:!!i,keyHasChanged:!1},tB(e)}(e,t,r,i)},destroy(){tw(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}(i(),i)}(document.querySelector("#board"),{highlight:{lastMove:!1},movable:{events:{after:(e,t)=>{let r={from:q(e),to:q(t)};rw.isLegal(r)?rw.play(r):rw.isLegal({...r,promotion:"queen"})&&rw.play({...r,promotion:"queen"}),rv.set({fen:eu.makeBoardFen(rw.board)}),rf.textContent=`${rw.turn} to play`,rb.textContent=`Best move: ${A(rp(rw.clone()))}`}}}});rm.addEventListener("submit",e=>{if(e.preventDefault(),rg.value){try{let e=eu.parseFen(rg.value).unwrap();rw=eo.fromSetup(e).unwrap(),rv.set({fen:eu.makeBoardFen(rw.board)}),rf.textContent=`${rw.turn} to play`,rb.textContent=`Best move: ${A(rp(rw))}`}catch(e){console.error(e)}rg.value=""}})}();
//# sourceMappingURL=index.082a427f.js.map

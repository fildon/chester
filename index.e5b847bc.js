!function(){let e="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class t{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,t){let{color:o,piece:n,from:s,to:l,flags:a,captured:h,promotion:d}=t,c=m(s),u=m(l);for(let s in this.color=o,this.piece=n,this.from=c,this.to=u,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=c+u,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="",r)r[s]&a&&(this.flags+=i[s]);h&&(this.captured=h),d&&(this.promotion=d,this.lan+=d)}isCapture(){return this.flags.indexOf(i.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(i.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(i.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(i.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(i.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(i.BIG_PAWN)>-1}}let i={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},r={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},o={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},n={b:[16,32,17,15],w:[-16,-32,-17,-15]},s={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},l=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],a=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],h={p:1,n:2,b:4,r:8,q:16,k:32},d=["n","b","r","q"],c={k:r.KSIDE_CASTLE,q:r.QSIDE_CASTLE},u={w:[{square:o.a1,flag:r.QSIDE_CASTLE},{square:o.h1,flag:r.KSIDE_CASTLE}],b:[{square:o.a8,flag:r.QSIDE_CASTLE},{square:o.h8,flag:r.KSIDE_CASTLE}]},p={b:1,w:6},f=["1-0","0-1","1/2-1/2","*"];function g(e){return -1!=="0123456789".indexOf(e)}function m(e){let t=15&e,i=e>>4;return"abcdefgh".substring(t,t+1)+"87654321".substring(i,i+1)}function b(e){return"w"===e?"b":"w"}function v(e,t,i,o,n,s,l=r.NORMAL){let a=o>>4;if("p"===n&&(7===a||0===a))for(let a=0;a<d.length;a++){let h=d[a];e.push({color:t,from:i,to:o,piece:n,captured:s,promotion:h,flags:l|r.PROMOTION})}else e.push({color:t,from:i,to:o,piece:n,captured:s,flags:l})}function _(e){let t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return"p"}return"o"===(t=t.toLowerCase())?"k":t}function w(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function k(e){return e.split(" ").slice(0,4).join(" ")}class y{_board=Array(128);_turn="w";_header={};_kings={w:-1,b:-1};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_positionCount={};constructor(t=e){this.load(t)}clear({preserveHeaders:e=!1}={}){this._board=Array(128),this._kings={w:-1,b:-1},this._turn="w",this._castling={w:0,b:0},this._epSquare=-1,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._positionCount={},delete this._header.SetUp,delete this._header.FEN}load(e,{skipValidation:t=!1,preserveHeaders:i=!1}={}){let n=e.split(/\s+/);if(n.length>=2&&n.length<6&&(e=n.concat(["-","-","0","1"].slice(-(6-n.length))).join(" ")),n=e.split(/\s+/),!t){let{ok:t,error:i}=function(e){let t=e.split(/\s+/);if(6!==t.length)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};let i=parseInt(t[5],10);if(isNaN(i)||i<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};let r=parseInt(t[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};let o=t[0].split("/");if(8!==o.length)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let e=0;e<o.length;e++){let t=0,i=!1;for(let r=0;r<o[e].length;r++)if(g(o[e][r])){if(i)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};t+=parseInt(o[e][r],10),i=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[e][r]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};t+=1,i=!1}if(8!==t)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if("3"==t[3][1]&&"w"==t[1]||"6"==t[3][1]&&"b"==t[1])return{ok:!1,error:"Invalid FEN: illegal en-passant square"};for(let{color:e,regex:i}of[{color:"white",regex:/K/g},{color:"black",regex:/k/g}]){if(!i.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${e} king`};if((t[0].match(i)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${e} kings`}}return Array.from(o[0]+o[7]).some(e=>"P"===e.toUpperCase())?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}(e);if(!t)throw Error(i)}let s=n[0],l=0;this.clear({preserveHeaders:i});for(let e=0;e<s.length;e++){let t=s.charAt(e);if("/"===t)l+=8;else if(g(t))l+=parseInt(t,10);else{let e=t<"a"?"w":"b";this._put({type:t.toLowerCase(),color:e},m(l)),l++}}this._turn=n[1],n[2].indexOf("K")>-1&&(this._castling.w|=r.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(this._castling.w|=r.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(this._castling.b|=r.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(this._castling.b|=r.QSIDE_CASTLE),this._epSquare="-"===n[3]?-1:o[n[3]],this._halfMoves=parseInt(n[4],10),this._moveNumber=parseInt(n[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){let e=0,t="";for(let i=o.a8;i<=o.h1;i++){if(this._board[i]){e>0&&(t+=e,e=0);let{color:r,type:o}=this._board[i];t+="w"===r?o.toUpperCase():o.toLowerCase()}else e++;i+1&136&&(e>0&&(t+=e),i!==o.h1&&(t+="/"),e=0,i+=8)}let i="";this._castling.w&r.KSIDE_CASTLE&&(i+="K"),this._castling.w&r.QSIDE_CASTLE&&(i+="Q"),this._castling.b&r.KSIDE_CASTLE&&(i+="k"),this._castling.b&r.QSIDE_CASTLE&&(i+="q"),i=i||"-";let n="-";if(-1!==this._epSquare){let e=this._epSquare+("w"===this._turn?16:-16);for(let t of[e+1,e-1]){if(136&t)continue;let e=this._turn;if(this._board[t]?.color===e&&this._board[t]?.type==="p"){this._makeMove({color:e,from:t,to:this._epSquare,piece:"p",captured:"p",flags:r.EP_CAPTURE});let i=!this._isKingAttacked(e);if(this._undoMove(),i){n=m(this._epSquare);break}}}}return[t,this._turn,i,n,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(t){this._history.length>0||(t!==e?(this._header.SetUp="1",this._header.FEN=t):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(e)}get(e){return this._board[o[e]]}put({type:e,color:t},i){return!!this._put({type:e,color:t},i)&&(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}_put({type:e,color:t},i){if(-1==="pnbrqkPNBRQK".indexOf(e.toLowerCase())||!(i in o))return!1;let r=o[i];if("k"==e&&!(-1==this._kings[t]||this._kings[t]==r))return!1;let n=this._board[r];return n&&"k"===n.type&&(this._kings[n.color]=-1),this._board[r]={type:e,color:t},"k"===e&&(this._kings[t]=r),!0}remove(e){let t=this.get(e);return delete this._board[o[e]],t&&"k"===t.type&&(this._kings[t.color]=-1),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){let e=this._board[o.e1]?.type==="k"&&this._board[o.e1]?.color==="w",t=this._board[o.e8]?.type==="k"&&this._board[o.e8]?.color==="b";e&&this._board[o.a1]?.type==="r"&&this._board[o.a1]?.color==="w"||(this._castling.w&=~r.QSIDE_CASTLE),e&&this._board[o.h1]?.type==="r"&&this._board[o.h1]?.color==="w"||(this._castling.w&=~r.KSIDE_CASTLE),t&&this._board[o.a8]?.type==="r"&&this._board[o.a8]?.color==="b"||(this._castling.b&=~r.QSIDE_CASTLE),t&&this._board[o.h8]?.type==="r"&&this._board[o.h8]?.color==="b"||(this._castling.b&=~r.KSIDE_CASTLE)}_updateEnPassantSquare(){if(-1===this._epSquare)return;let e=this._epSquare+("w"===this._turn?-16:16),t=this._epSquare+("w"===this._turn?16:-16);if(null!==this._board[e]||null!==this._board[this._epSquare]||this._board[t]?.color!==b(this._turn)||this._board[t]?.type!=="p"){this._epSquare=-1;return}[t+1,t-1].some(e=>!(136&e)&&this._board[e]?.color===this._turn&&this._board[e]?.type==="p")||(this._epSquare=-1)}_attacked(e,t,i){let r=[];for(let n=o.a8;n<=o.h1;n++){if(136&n){n+=7;continue}if(void 0===this._board[n]||this._board[n].color!==e)continue;let o=this._board[n],s=n-t;if(0===s)continue;let d=s+119;if(l[d]&h[o.type]){if("p"===o.type){if(s>0&&"w"===o.color||s<=0&&"b"===o.color){if(!i)return!0;r.push(m(n))}continue}if("n"===o.type||"k"===o.type){if(!i)return!0;r.push(m(n));continue}let e=a[d],l=n+e,h=!1;for(;l!==t;){if(null!=this._board[l]){h=!0;break}l+=e}if(!h){if(!i)return!0;r.push(m(n));continue}}}return!!i&&r}attackers(e,t){return t?this._attacked(t,o[e],!0):this._attacked(this._turn,o[e],!0)}_isKingAttacked(e){let t=this._kings[e];return -1!==t&&this._attacked(b(e),t)}isAttacked(e,t){return this._attacked(t,o[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&0===this._moves().length}isStalemate(){return!this.isCheck()&&0===this._moves().length}isInsufficientMaterial(){let e={b:0,n:0,r:0,q:0,k:0,p:0},t=[],i=0,r=0;for(let n=o.a8;n<=o.h1;n++){if(r=(r+1)%2,136&n){n+=7;continue}let o=this._board[n];o&&(e[o.type]=o.type in e?e[o.type]+1:1,"b"===o.type&&t.push(r),i++)}if(2===i||3===i&&(1===e.b||1===e.n))return!0;if(i===e.b+2){let e=0,i=t.length;for(let r=0;r<i;r++)e+=t[r];if(0===e||e===i)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:i,piece:r}={}){let o=this._moves({square:i,piece:r});return e?o.map(e=>new t(this,e)):o.map(e=>this._moveToSan(e,o))}_moves({legal:e=!0,piece:t,square:i}={}){let l=i?i.toLowerCase():void 0,a=t?.toLowerCase(),h=[],d=this._turn,c=b(d),u=o.a8,f=o.h1,g=!1;if(l){if(!(l in o))return[];u=f=o[l],g=!0}for(let e=u;e<=f;e++){let t;if(136&e){e+=7;continue}if(!this._board[e]||this._board[e].color===c)continue;let{type:i}=this._board[e];if("p"===i){if(a&&a!==i)continue;t=e+n[d][0],this._board[t]||(v(h,d,e,t,"p"),t=e+n[d][1],p[d]!==e>>4||this._board[t]||v(h,d,e,t,"p",void 0,r.BIG_PAWN));for(let i=2;i<4;i++)136&(t=e+n[d][i])||(this._board[t]?.color===c?v(h,d,e,t,"p",this._board[t].type,r.CAPTURE):t===this._epSquare&&v(h,d,e,t,"p","p",r.EP_CAPTURE))}else{if(a&&a!==i)continue;for(let o=0,n=s[i].length;o<n;o++){let n=s[i][o];for(t=e;!(136&(t+=n));){if(this._board[t]){if(this._board[t].color===d)break;v(h,d,e,t,i,this._board[t].type,r.CAPTURE);break}if(v(h,d,e,t,i),"n"===i||"k"===i)break}}}}if((void 0===a||"k"===a)&&(!g||f===this._kings[d])){if(this._castling[d]&r.KSIDE_CASTLE){let e=this._kings[d],t=e+2;this._board[e+1]||this._board[t]||this._attacked(c,this._kings[d])||this._attacked(c,e+1)||this._attacked(c,t)||v(h,d,this._kings[d],t,"k",void 0,r.KSIDE_CASTLE)}if(this._castling[d]&r.QSIDE_CASTLE){let e=this._kings[d],t=e-2;this._board[e-1]||this._board[e-2]||this._board[e-3]||this._attacked(c,this._kings[d])||this._attacked(c,e-1)||this._attacked(c,t)||v(h,d,this._kings[d],t,"k",void 0,r.QSIDE_CASTLE)}}if(!e||-1===this._kings[d])return h;let m=[];for(let e=0,t=h.length;e<t;e++)this._makeMove(h[e]),this._isKingAttacked(d)||m.push(h[e]),this._undoMove();return m}move(e,{strict:i=!1}={}){let r=null;if("string"==typeof e)r=this._moveFromSan(e,i);else if("object"==typeof e){let t=this._moves();for(let i=0,o=t.length;i<o;i++)if(e.from===m(t[i].from)&&e.to===m(t[i].to)&&(!("promotion"in t[i])||e.promotion===t[i].promotion)){r=t[i];break}}if(!r){if("string"==typeof e)throw Error(`Invalid move: ${e}`);throw Error(`Invalid move: ${JSON.stringify(e)}`)}let o=new t(this,r);return this._makeMove(r),this._incPositionCount(o.after),o}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){let t=this._turn,i=b(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&r.EP_CAPTURE&&("b"===this._turn?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),"k"===this._board[e.to].type){if(this._kings[t]=e.to,e.flags&r.KSIDE_CASTLE){let t=e.to-1,i=e.to+1;this._board[t]=this._board[i],delete this._board[i]}else if(e.flags&r.QSIDE_CASTLE){let t=e.to+1,i=e.to-2;this._board[t]=this._board[i],delete this._board[i]}this._castling[t]=0}if(this._castling[t]){for(let i=0,r=u[t].length;i<r;i++)if(e.from===u[t][i].square&&this._castling[t]&u[t][i].flag){this._castling[t]^=u[t][i].flag;break}}if(this._castling[i]){for(let t=0,r=u[i].length;t<r;t++)if(e.to===u[i][t].square&&this._castling[i]&u[i][t].flag){this._castling[i]^=u[i][t].flag;break}}e.flags&r.BIG_PAWN?"b"===t?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=-1,"p"===e.piece?this._halfMoves=0:e.flags&(r.CAPTURE|r.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,"b"===t&&this._moveNumber++,this._turn=i}undo(){let e=this._undoMove();if(e){let i=new t(this,e);return this._decPositionCount(i.after),i}return null}_undoMove(){let e=this._history.pop();if(void 0===e)return null;let t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;let i=this._turn,o=b(i);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured){if(t.flags&r.EP_CAPTURE){let e;e="b"===i?t.to-16:t.to+16,this._board[e]={type:"p",color:o}}else this._board[t.to]={type:t.captured,color:o}}if(t.flags&(r.KSIDE_CASTLE|r.QSIDE_CASTLE)){let e,i;t.flags&r.KSIDE_CASTLE?(e=t.to+1,i=t.to-1):(e=t.to-2,i=t.to+1),this._board[e]=this._board[i],delete this._board[i]}return t}pgn({newline:e="\n",maxWidth:t=0}={}){let i=[],r=!1;for(let t in this._header)i.push("["+t+' "'+this._header[t]+'"]'+e),r=!0;r&&this._history.length&&i.push(e);let o=e=>{let t=this._comments[this.fen()];if(void 0!==t){let i=e.length>0?" ":"";e=`${e}${i}{${t}}`}return e},n=[];for(;this._history.length>0;)n.push(this._undoMove());let s=[],l="";for(0===n.length&&s.push(o(""));n.length>0;){l=o(l);let e=n.pop();if(!e)break;if(this._history.length||"b"!==e.color)"w"===e.color&&(l.length&&s.push(l),l=this._moveNumber+".");else{let e=`${this._moveNumber}. ...`;l=l?`${l} ${e}`:e}l=l+" "+this._moveToSan(e,this._moves({legal:!0})),this._makeMove(e)}if(l.length&&s.push(o(l)),void 0!==this._header.Result&&s.push(this._header.Result),0===t)return i.join("")+s.join(" ");let a=function(){return i.length>0&&" "===i[i.length-1]&&(i.pop(),!0)},h=0;for(let r=0;r<s.length;r++){if(h+s[r].length>t&&s[r].includes("{")){h=function(r,o){for(let n of o.split(" "))if(n){if(r+n.length>t){for(;a();)r--;i.push(e),r=0}i.push(n),r+=n.length,i.push(" "),r++}return a()&&r--,r}(h,s[r]);continue}h+s[r].length>t&&0!==r?(" "===i[i.length-1]&&i.pop(),i.push(e),h=0):0!==r&&(i.push(" "),h++),i.push(s[r]),h+=s[r].length}return i.join("")}header(...e){for(let t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t,this._header}removeHeader(e){return e in this._header&&(delete this._header[e],!0)}getHeaders(){return this._header}loadPgn(e,{strict:t=!1,newlineChar:i="\r?\n"}={}){function r(e){return e.replace(/\\/g,"\\")}e=e.trim();let o=RegExp("^(\\[((?:"+r(i)+")|.)*\\])((?:\\s*"+r(i)+"){2}|(?:\\s*"+r(i)+")*$)").exec(e),n=o&&o.length>=2?o[1]:"";this.reset();let s=function(e){let t={},o=e.split(new RegExp(r(i))),n="",s="";for(let e=0;e<o.length;e++){let i=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;n=o[e].replace(i,"$1"),s=o[e].replace(i,"$2"),n.trim().length>0&&(t[n]=s)}return t}(n),l="";for(let e in s)"fen"===e.toLowerCase()&&(l=s[e]),this.header(e,s[e]);if(t){if("1"===s.SetUp){if(!("FEN"in s))throw Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}}else l&&this.load(l,{preserveHeaders:!0});let a=function(e){return e=e.replace(RegExp(r(i),"g")," "),`{${Array.from(e.slice(1,e.length-1)).map(function(e){return 128>e.charCodeAt(0)?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/%/g,"").toLowerCase()}).join("")}}`},h=e.replace(n,"").replace(RegExp(`({[^}]*})+?|;([^${r(i)}]*)`,"g"),function(e,t,i){return void 0!==t?a(t):" "+a(`{${i.slice(1)}}`)}).replace(RegExp(r(i),"g")," "),d=/(\([^()]+\))+?/g;for(;d.test(h);)h=h.replace(d,"");let c=(h=(h=(h=h.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).trim().split(new RegExp(/\s+/));c=c.filter(e=>""!==e);let u="";for(let e=0;e<c.length;e++){let i=function(e){if(e.startsWith("{")&&e.endsWith("}")){var t;return 0==(t=e.slice(1,e.length-1)).length?"":decodeURIComponent("%"+(t.match(/.{1,2}/g)||[]).join("%"))}}(c[e]);if(void 0!==i){this._comments[this.fen()]=i;continue}let r=this._moveFromSan(c[e],t);if(null==r){if(f.indexOf(c[e])>-1)u=c[e];else throw Error(`Invalid move in PGN: ${c[e]}`)}else u="",this._makeMove(r),this._incPositionCount(this.fen())}u&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",u)}_moveToSan(e,t){let i="";if(e.flags&r.KSIDE_CASTLE)i="O-O";else if(e.flags&r.QSIDE_CASTLE)i="O-O-O";else{if("p"!==e.piece){let r=function(e,t){let i=e.from,r=e.to,o=e.piece,n=0,s=0,l=0;for(let e=0,a=t.length;e<a;e++){let a=t[e].from,h=t[e].to;o===t[e].piece&&i!==a&&r===h&&(n++,i>>4==a>>4&&s++,(15&i)==(15&a)&&l++)}return n>0?s>0&&l>0?m(i):l>0?m(i).charAt(1):m(i).charAt(0):""}(e,t);i+=e.piece.toUpperCase()+r}e.flags&(r.CAPTURE|r.EP_CAPTURE)&&("p"===e.piece&&(i+=m(e.from)[0]),i+="x"),i+=m(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,t=!1){let i,r,n,s,l;let a=w(e),h=_(a),d=this._moves({legal:!0,piece:h});for(let e=0,t=d.length;e<t;e++)if(a===w(this._moveToSan(d[e],d)))return d[e];if(t)return null;let c=!1;if((r=a.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/))?(i=r[1],n=r[2],s=r[3],l=r[4],1==n.length&&(c=!0)):(r=a.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/))&&(i=r[1],n=r[2],s=r[3],l=r[4],1==n.length&&(c=!0)),h=_(a),d=this._moves({legal:!0,piece:i||h}),!s)return null;for(let e=0,t=d.length;e<t;e++)if(n){if((!i||i.toLowerCase()==d[e].piece)&&o[n]==d[e].from&&o[s]==d[e].to&&(!l||l.toLowerCase()==d[e].promotion))return d[e];if(c){let t=m(d[e].from);if((!i||i.toLowerCase()==d[e].piece)&&o[s]==d[e].to&&(n==t[0]||n==t[1])&&(!l||l.toLowerCase()==d[e].promotion))return d[e]}}else if(a===w(this._moveToSan(d[e],d)).replace("x",""))return d[e];return null}ascii(){let e="   +------------------------+\n";for(let t=o.a8;t<=o.h1;t++){if(0==(15&t)&&(e+=" "+"87654321"[t>>4]+" |"),this._board[t]){let i=this._board[t].type;e+=" "+("w"===this._board[t].color?i.toUpperCase():i.toLowerCase())+" "}else e+=" . ";t+1&136&&(e+="|\n",t+=8)}return e+"   +------------------------+\n     a  b  c  d  e  f  g  h"}perft(e){let t=this._moves({legal:!1}),i=0,r=this._turn;for(let o=0,n=t.length;o<n;o++)this._makeMove(t[o]),!this._isKingAttacked(r)&&(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}turn(){return this._turn}board(){let e=[],t=[];for(let i=o.a8;i<=o.h1;i++)null==this._board[i]?t.push(null):t.push({square:m(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(t),t=[],i+=8);return e}squareColor(e){if(e in o){let t=o[e];return((t>>4)+(15&t))%2==0?"light":"dark"}return null}history({verbose:e=!1}={}){let i=[],r=[];for(;this._history.length>0;)i.push(this._undoMove());for(;;){let o=i.pop();if(!o)break;e?r.push(new t(this,o)):r.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return r}_getPositionCount(e){let t=k(e);return this._positionCount[t]||0}_incPositionCount(e){let t=k(e);void 0===this._positionCount[t]&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){let t=k(e);1===this._positionCount[t]?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){let e=[],t={},i=e=>{e in this._comments&&(t[e]=this._comments[e])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){let t=e.pop();if(!t)break;this._makeMove(t),i(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){let e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{let t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(let i of["k","q"])void 0!==t[i]&&(t[i]?this._castling[e]|=c[i]:this._castling[e]&=~c[i]);this._updateCastlingRights();let i=this.getCastlingRights(e);return(void 0===t.k||t.k===i.k)&&(void 0===t.q||t.q===i.q)}getCastlingRights(e){return{k:(this._castling[e]&c.k)!=0,q:(this._castling[e]&c.q)!=0}}moveNumber(){return this._moveNumber}}let C=["white","black"],S=["a","b","c","d","e","f","g","h"],E=["1","2","3","4","5","6","7","8"],P=[...E].reverse(),M=Array.prototype.concat(...S.map(e=>E.map(t=>e+t))),A=e=>M[8*e[0]+e[1]],q=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],T=M.map(q),I=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;let t=performance.now()-e;return e=void 0,t}}},x=e=>"white"===e?"black":"white",N=(e,t)=>{let i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r},L=(e,t)=>e.role===t.role&&e.color===t.color,O=e=>(t,i)=>[(i?t[0]:7-t[0])*e.width/8,(i?7-t[1]:t[1])*e.height/8],R=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},K=(e,t,i=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${i})`},D=(e,t)=>{e.style.visibility=t?"visible":"hidden"},$=e=>{var t;return e.clientX||0===e.clientX?[e.clientX,e.clientY]:(null===(t=e.targetTouches)||void 0===t?void 0:t[0])?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},F=e=>2===e.button,W=(e,t)=>{let i=document.createElement(e);return t&&(i.className=t),i};function Q(e,t,i){let r=q(e);return t||(r[0]=7-r[0],r[1]=7-r[1]),[i.left+i.width*r[0]/8+i.width/16,i.top+i.height*(7-r[1])/8+i.height/16]}let U=(e,t)=>Math.abs(e-t),B=e=>(t,i,r,o)=>2>U(t,r)&&("white"===e?o===i+1||i<=1&&o===i+2&&t===r:o===i-1||i>=6&&o===i-2&&t===r),H=(e,t,i,r)=>{let o=U(e,i),n=U(t,r);return 1===o&&2===n||2===o&&1===n},j=(e,t,i,r)=>U(e,i)===U(t,r),z=(e,t,i,r)=>e===i||t===r,G=(e,t,i,r)=>j(e,t,i,r)||z(e,t,i,r),V=(e,t,i)=>(r,o,n,s)=>2>U(r,n)&&2>U(o,s)||i&&o===s&&o===("white"===e?0:7)&&(4===r&&(2===n&&t.includes(0)||6===n&&t.includes(7))||t.includes(n));function Z(e,t,i){let r=e.get(t);if(!r)return[];let o=q(t),n=r.role,s="pawn"===n?B(r.color):"knight"===n?H:"bishop"===n?j:"rook"===n?z:"queen"===n?G:V(r.color,function(e,t){let i="white"===t?"1":"8",r=[];for(let[o,n]of e)o[1]===i&&n.color===t&&"rook"===n.role&&r.push(q(o)[0]);return r}(e,r.color),i);return T.filter(e=>(o[0]!==e[0]||o[1]!==e[1])&&s(o[0],o[1],e[0],e[1])).map(A)}function X(e,...t){e&&setTimeout(()=>e(...t),1)}function Y(e){e.premovable.current&&(e.premovable.current=void 0,X(e.premovable.events.unset))}function J(e){let t=e.predroppable;t.current&&(t.current=void 0,X(t.events.unset))}function ee(e,t,i){let r=e.pieces.get(t),o=e.pieces.get(i);if(t===i||!r)return!1;let n=o&&o.color!==r.color?o:void 0;return i===e.selected&&el(e),X(e.events.move,t,i,n),!function(e,t,i){if(!e.autoCastle)return!1;let r=e.pieces.get(t);if(!r||"king"!==r.role)return!1;let o=q(t),n=q(i);if(0!==o[1]&&7!==o[1]||o[1]!==n[1])return!1;4!==o[0]||e.pieces.has(i)||(6===n[0]?i=A([7,n[1]]):2===n[0]&&(i=A([0,n[1]])));let s=e.pieces.get(i);return!!s&&s.color===r.color&&"rook"===s.role&&(e.pieces.delete(t),e.pieces.delete(i),o[0]<n[0]?(e.pieces.set(A([6,n[1]]),r),e.pieces.set(A([5,n[1]]),s)):(e.pieces.set(A([2,n[1]]),r),e.pieces.set(A([3,n[1]]),s)),!0)}(e,t,i)&&(e.pieces.set(i,r),e.pieces.delete(t)),e.lastMove=[t,i],e.check=void 0,X(e.events.change),n||!0}function et(e,t,i,r){if(e.pieces.has(i)){if(!r)return!1;e.pieces.delete(i)}return X(e.events.dropNewPiece,t,i),e.pieces.set(i,t),e.lastMove=[i],e.check=void 0,X(e.events.change),e.movable.dests=void 0,e.turnColor=x(e.turnColor),!0}function ei(e,t,i){let r=ee(e,t,i);return r&&(e.movable.dests=void 0,e.turnColor=x(e.turnColor),e.animation.current=void 0),r}function er(e,t,i){if(eh(e,t,i)){let r=ei(e,t,i);if(r){let o=e.hold.stop();el(e);let n={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return!0!==r&&(n.captured=r),X(e.movable.events.after,t,i,n),!0}}else if(function(e,t,i){var r,o;let n=null!==(o=null===(r=e.premovable.customDests)||void 0===r?void 0:r.get(t))&&void 0!==o?o:Z(e.pieces,t,e.premovable.castle);return t!==i&&ed(e,t)&&n.includes(i)}(e,t,i)){var r;return r={ctrlKey:e.stats.ctrlKey},J(e),e.premovable.current=[t,i],X(e.premovable.events.set,t,i,r),el(e),!0}return el(e),!1}function eo(e,t,i,r){let o=e.pieces.get(t);if(o&&(function(e,t,i){let r=e.pieces.get(t);return!!r&&(t===i||!e.pieces.has(i))&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}(e,t,i)||r))e.pieces.delete(t),et(e,o,i,r),X(e.movable.events.afterNewPiece,o.role,i,{premove:!1,predrop:!1});else if(o&&function(e,t,i){let r=e.pieces.get(t),o=e.pieces.get(i);return!!r&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==r.role||"1"!==i[1]&&"8"!==i[1])&&e.movable.color===r.color&&e.turnColor!==r.color}(e,t,i)){var n;n=o.role,Y(e),e.predroppable.current={role:n,key:i},X(e.predroppable.events.set,n,i)}else Y(e),J(e);e.pieces.delete(t),el(e)}function en(e,t,i){if(X(e.events.select,t),e.selected){if(e.selected!==t||e.draggable.enabled){if((e.selectable.enabled||i)&&e.selected!==t&&er(e,e.selected,t)){e.stats.dragged=!1;return}}else{el(e),e.hold.cancel();return}}(e.selectable.enabled||e.draggable.enabled)&&(ea(e,t)||ed(e,t))&&(es(e,t),e.hold.start())}function es(e,t){e.selected=t,ed(e,t)?e.premovable.customDests||(e.premovable.dests=Z(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function el(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function ea(e,t){let i=e.pieces.get(t);return!!i&&("both"===e.movable.color||e.movable.color===i.color&&e.turnColor===i.color)}let eh=(e,t,i)=>{var r,o;return t!==i&&ea(e,t)&&(e.movable.free||!!(null===(o=null===(r=e.movable.dests)||void 0===r?void 0:r.get(t))||void 0===o?void 0:o.includes(i)))};function ed(e,t){let i=e.pieces.get(t);return!!i&&e.premovable.enabled&&e.movable.color===i.color&&e.turnColor!==i.color}function ec(e){let t=e.premovable.current;if(!t)return!1;let i=t[0],r=t[1],o=!1;if(eh(e,i,r)){let t=ei(e,i,r);if(t){let n={premove:!0};!0!==t&&(n.captured=t),X(e.movable.events.after,i,r,n),o=!0}}return Y(e),o}function eu(e){Y(e),J(e),el(e)}function ep(e){e.movable.color=e.movable.dests=e.animation.current=void 0,eu(e)}function ef(e,t,i){let r=Math.floor(8*(e[0]-i.left)/i.width);t||(r=7-r);let o=7-Math.floor(8*(e[1]-i.top)/i.height);return t||(o=7-o),r>=0&&r<8&&o>=0&&o<8?A([r,o]):void 0}let eg=e=>"white"===e.orientation,em="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",eb={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},ev={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function e_(e){"start"===e&&(e=em);let t=new Map,i=7,r=0;for(let o of e)switch(o){case" ":case"[":return t;case"/":if(--i<0)return t;r=0;break;case"~":{let e=t.get(A([r-1,i]));e&&(e.promoted=!0);break}default:{let e=o.charCodeAt(0);if(e<57)r+=e-48;else{let e=o.toLowerCase();t.set(A([r,i]),{role:eb[e],color:o===e?"black":"white"}),++r}}}return t}function ew(e,t){t.animation&&(ey(e.animation,t.animation),70>(e.animation.duration||0)&&(e.animation.enabled=!1))}function ek(e,t){var i,r,o;if((null===(i=t.movable)||void 0===i?void 0:i.dests)&&(e.movable.dests=void 0),(null===(r=t.drawable)||void 0===r?void 0:r.autoShapes)&&(e.drawable.autoShapes=[]),ey(e,t),t.fen&&(e.pieces=e_(t.fen),e.drawable.shapes=(null===(o=t.drawable)||void 0===o?void 0:o.shapes)||[]),"check"in t&&function(e,t){if(e.check=void 0,!0===t&&(t=e.turnColor),t)for(let[i,r]of e.pieces)"king"===r.role&&r.color===t&&(e.check=i)}(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&es(e,e.selected),ew(e,t),!e.movable.rookCastle&&e.movable.dests){let t="white"===e.movable.color?"1":"8",i="e"+t,r=e.movable.dests.get(i),o=e.pieces.get(i);if(!r||!o||"king"!==o.role)return;e.movable.dests.set(i,r.filter(e=>!(e==="a"+t&&r.includes("c"+t))&&!(e==="h"+t&&r.includes("g"+t))))}}function ey(e,t){for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)&&eC(e[i])&&eC(t[i])?ey(e[i],t[i]):e[i]=t[i])}function eC(e){if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}let eS=(e,t)=>t.animation.enabled?function(e,t){let i=new Map(t.pieces),r=e(t),o=function(e,t){let i,r,o;let n=new Map,s=[],l=new Map,a=[],h=[],d=new Map;for(let[t,i]of e)d.set(t,eP(t,i));for(let e of M)i=t.pieces.get(e),r=d.get(e),i?r?L(i,r.piece)||(a.push(r),h.push(eP(e,i))):h.push(eP(e,i)):r&&a.push(r);for(let e of h)(r=eM(e,a.filter(t=>L(e.piece,t.piece))))&&(o=[r.pos[0]-e.pos[0],r.pos[1]-e.pos[1]],n.set(e.key,o.concat(o)),s.push(r.key));for(let e of a)s.includes(e.key)||l.set(e.key,e.piece);return{anims:n,fadings:l}}(i,t);if(o.anims.size||o.fadings.size){let e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:o},e||function e(t,i){let r=t.animation.current;if(void 0===r){t.dom.destroyed||t.dom.redrawNow();return}let o=1-(i-r.start)*r.frequency;if(o<=0)t.animation.current=void 0,t.dom.redrawNow();else{let i=eA(o);for(let e of r.plan.anims.values())e[2]=e[0]*i,e[3]=e[1]*i;t.dom.redrawNow(!0),requestAnimationFrame((i=performance.now())=>e(t,i))}}(t,performance.now())}else t.dom.redraw();return r}(e,t):eE(e,t);function eE(e,t){let i=e(t);return t.dom.redraw(),i}let eP=(e,t)=>({key:e,pos:q(e),piece:t}),eM=(e,t)=>t.sort((t,i)=>N(e.pos,t.pos)-N(e.pos,i.pos))[0],eA=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,eq=["green","red","blue","yellow"];function eT(e,t){e.drawable.current&&(e.drawable.current.pos=$(t))}function eI(e){let t=e.drawable.current;t&&(t.mouseSq&&function(e,t){let i=e=>e.orig===t.orig&&e.dest===t.dest,r=e.shapes.find(i);r&&(e.shapes=e.shapes.filter(e=>!i(e))),r&&r.brush===t.brush||e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),eN(e)}(e.drawable,t),ex(e))}function ex(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function eN(e){e.onChange&&e.onChange(e.shapes)}function eL(e){requestAnimationFrame(()=>{var t;let i=e.draggable.current;if(!i)return;(null===(t=e.animation.current)||void 0===t?void 0:t.plan.anims.has(i.orig))&&(e.animation.current=void 0);let r=e.pieces.get(i.orig);if(r&&L(r,i.piece)){if(!i.started&&N(i.pos,i.origPos)>=Math.pow(e.draggable.distance,2)&&(i.started=!0),i.started){if("function"==typeof i.element){let e=i.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),i.element=e}let t=e.dom.bounds();R(i.element,[i.pos[0]-t.left-t.width/16,i.pos[1]-t.top-t.height/16]),i.keyHasChanged||(i.keyHasChanged=i.orig!==ef(i.pos,eg(e),t))}}else eK(e);eL(e)})}function eO(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=$(t))}function eR(e,t){let i=e.draggable.current;if(!i)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&i.originTarget!==t.target&&!i.newPiece){e.draggable.current=void 0;return}Y(e),J(e);let r=ef($(t)||i.pos,eg(e),e.dom.bounds());r&&i.started&&i.orig!==r?i.newPiece?eo(e,i.orig,r,i.force):(e.stats.ctrlKey=t.ctrlKey,er(e,i.orig,r)&&(e.stats.dragged=!0)):i.newPiece?e.pieces.delete(i.orig):e.draggable.deleteOnDropOff&&!r&&(e.pieces.delete(i.orig),X(e.events.change)),(i.orig===i.previouslySelected||i.keyHasChanged)&&(i.orig===r||!r)?el(e):e.selectable.enabled||el(e),eD(e),e.draggable.current=void 0,e.dom.redraw()}function eK(e){let t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,el(e),eD(e),e.dom.redraw())}function eD(e){let t=e.dom.elements;t.ghost&&D(t.ghost,!1)}function e$(e,t){let i=e.dom.elements.board.firstChild;for(;i;){if(i.cgKey===t&&"PIECE"===i.tagName)return i;i=i.nextSibling}}function eF(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}let eW={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function eQ({orig:e,dest:t,brush:i,piece:r,modifiers:o,customSvg:n,label:s},l,a,h){var d,c;return[h.width,h.height,a,e,t,i,l&&"-",r&&[r.color,r.role,r.scale].filter(e=>e).join(","),o&&[o.lineWidth,o.hilite&&"*"].filter(e=>e).join(","),n&&`custom-${eU(n.html)},${null!==(c=null===(d=n.center)||void 0===d?void 0:d[0])&&void 0!==c?c:"o"}`,s&&`label-${eU(s.text)}`].filter(e=>e).join(",")}function eU(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i)>>>0;return t.toString()}function eB(e){return["#ffffff","#fff","white"].includes(e.color)?eW.hilitePrimary:eW.hiliteWhite}function eH(e,t){return"white"===t?e:[7-e[0],7-e[1]]}function ej(e,t){return!0===(e&&t.has(e)&&t.get(e).size>1)}function ez(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function eG(e,t){for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.setAttribute(i,t[i]);return e}function eV(e,t){return t?{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(e=>e).join("")}:e}function eZ(e,t){return(e.opacity||1)*(t?.9:1)}function eX(e,t){let i=Math.min(1,t.width/t.height),r=Math.min(1,t.height/t.width);return[(e[0]-3.5)*i,(3.5-e[1])*r]}function eY(e,t,i=!0){let r=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return i?(Math.round(8*r/Math.PI)+16)%16:r}function eJ(e,t,i){let r=Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((e,t)=>e+t*t,0)),o=eY(e,t,!1);if(i&&(r-=33/64,i.size>1)){r-=10/64;let o=eY(e,t);(i.has((o+1)%16)||i.has((o+15)%16))&&1&o&&(r-=.4)}return[e[0]-Math.cos(o)*r,e[1]-Math.sin(o)*r].map(e=>e+.5)}function e0(e,t){let i;let r=W("coords",t);for(let t of e)(i=W("coord")).textContent=t,r.appendChild(i);return r}function e1(e,t,i,r){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i,r)}let e2=e=>t=>{e.draggable.current?eK(e):e.drawable.current?ex(e):t.shiftKey||F(t)?e.drawable.enabled&&function(e,t){var i;if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?el(e):eu(e);let r=$(t),o=ef(r,eg(e),e.dom.bounds());o&&(e.drawable.current={orig:o,pos:r,brush:eq[((t.shiftKey||t.ctrlKey)&&F(t)?1:0)+(t.altKey||t.metaKey||(null===(i=t.getModifierState)||void 0===i?void 0:i.call(t,"AltGraph"))?2:0)],snapToValidMove:e.drawable.defaultSnapToValidMove},function e(t){requestAnimationFrame(()=>{let i=t.drawable.current;if(i){let r=ef(i.pos,eg(t),t.dom.bounds());r||(i.snapToValidMove=!1);let o=i.snapToValidMove?function(e,t,i,r){let o=q(e),n=T.filter(e=>G(o[0],o[1],e[0],e[1])||H(o[0],o[1],e[0],e[1])),s=n.map(e=>Q(A(e),i,r)).map(e=>N(t,e)),[,l]=s.reduce((e,t,i)=>e[0]<t?e:[t,i],[s[0],0]);return A(n[l])}(i.orig,i.pos,eg(t),t.dom.bounds()):r;o!==i.mouseSq&&(i.mouseSq=o,i.dest=o!==i.orig?o:void 0,t.dom.redrawNow()),e(t)}})}(e))}(e,t):e.viewOnly||(e.dropmode.active?function(e,t){if(!e.dropmode.active)return;Y(e),J(e);let i=e.dropmode.piece;if(i){e.pieces.set("a0",i);let r=$(t),o=r&&ef(r,eg(e),e.dom.bounds());o&&eo(e,"a0",o)}e.dom.redraw()}(e,t):function(e,t){if(!(e.trustAllEvents||t.isTrusted)||void 0!==t.buttons&&t.buttons>1||t.touches&&t.touches.length>1)return;let i=e.dom.bounds(),r=$(t),o=ef(r,eg(e),i);if(!o)return;let n=e.pieces.get(o),s=e.selected;if(!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!n||n.color!==e.turnColor)&&e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),eN(e.drawable)),!1!==t.cancelable&&(!t.touches||e.blockTouchScroll||n||s||function(e,t){let i=eg(e),r=e.dom.bounds(),o=Math.pow(r.width/8,2);for(let n of e.pieces.keys())if(N(Q(n,i,r),t)<=o)return!0;return!1}(e,r)))t.preventDefault();else if(t.touches)return;let l=!!e.premovable.current,a=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&eh(e,e.selected,o)?eS(e=>en(e,o),e):en(e,o);let h=e.selected===o,d=e$(e,o);if(n&&d&&h&&function(e,t){let i=e.pieces.get(t);return!!i&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===i.color&&(e.turnColor===i.color||e.premovable.enabled))}(e,o)){e.draggable.current={orig:o,piece:n,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:d,previouslySelected:s,originTarget:t.target,keyHasChanged:!1},d.cgDragging=!0,d.classList.add("dragging");let l=e.dom.elements.ghost;l&&(l.className=`ghost ${n.color} ${n.role}`,R(l,O(i)(q(o),eg(e))),D(l,!0)),eL(e)}else l&&Y(e),a&&J(e);e.dom.redraw()}(e,t))},e6=(e,t,i)=>r=>{e.drawable.current?e.drawable.enabled&&i(e,r):e.viewOnly||t(e,r)};function e8(e){var t,i;let r=e.dom.elements.wrap.getBoundingClientRect(),o=e.dom.elements.container,n=r.height/r.width,s=8*Math.floor(r.width*window.devicePixelRatio/8)/window.devicePixelRatio,l=s*n;o.style.width=s+"px",o.style.height=l+"px",e.dom.bounds.clear(),null===(t=e.addDimensionsCssVarsTo)||void 0===t||t.style.setProperty("---cg-width",s+"px"),null===(i=e.addDimensionsCssVarsTo)||void 0===i||i.style.setProperty("---cg-height",l+"px")}let e4=e=>"PIECE"===e.tagName,e3=e=>"SQUARE"===e.tagName;function e5(e,t){for(let i of t)e.dom.elements.board.removeChild(i)}function e7(e,t){let i=e[1];return`${t?10-i:3+i}`}let e9=e=>`${e.color} ${e.role}`;function te(e,t,i){let r=e.get(t);r?e.set(t,`${r} ${i}`):e.set(t,i)}function tt(e,t,i){let r=e.get(t);r?r.push(i):e.set(t,[i])}let ti=e=>{var t,i,r;return[e.orig,null===(t=e.piece)||void 0===t?void 0:t.role,null===(i=e.piece)||void 0===i?void 0:i.color,null===(r=e.piece)||void 0===r?void 0:r.scale].join(",")},tr=new y,to=function(e,t){let i={pieces:e_(em),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:I()};function r(){let t;let r="dom"in i?i.dom.unbind:void 0,o=function(e,t){let i,r,o,n;for(let i of(e.innerHTML="",e.classList.add("cg-wrap"),C))e.classList.toggle("orientation-"+i,t.orientation===i);e.classList.toggle("manipulable",!t.viewOnly);let s=W("cg-container");e.appendChild(s);let l=W("cg-board");if(s.appendChild(l),t.drawable.visible&&((i=eG(ez("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"})).appendChild(function(){let e=ez("defs"),t=eG(ez("filter"),{id:"cg-filter-blur"});return t.appendChild(eG(ez("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}()),i.appendChild(ez("g")),(r=eG(ez("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"})).appendChild(ez("g")),o=W("cg-auto-pieces"),s.appendChild(i),s.appendChild(r),s.appendChild(o)),t.coordinates){let e="black"===t.orientation?" black":"",i="left"===t.ranksPosition?" left":"";if(t.coordinatesOnSquares){let r="white"===t.orientation?e=>e+1:e=>8-e;S.forEach((t,o)=>s.appendChild(e0(E.map(e=>t+e),"squares rank"+r(o)+e+i)))}else s.appendChild(e0(E,"ranks"+e+i)),s.appendChild(e0(S,"files"+e))}return t.draggable.enabled&&t.draggable.showGhost&&(D(n=W("piece","ghost"),!1),s.appendChild(n)),{board:l,container:s,wrap:e,ghost:n,svg:i,customSvg:r,autoPieces:o}}(e,i),n=function(e){let t;let i=()=>(void 0===t&&(t=e()),t);return i.clear=()=>{t=void 0},i}(()=>o.board.getBoundingClientRect()),s=e=>{if(!function(e){let t,i,r,o,n,s,l,a,h,d;let c=eg(e),u=O(e.dom.bounds()),p=e.dom.elements.board,f=e.pieces,g=e.animation.current,m=g?g.plan.anims:new Map,b=g?g.plan.fadings:new Map,v=e.draggable.current,_=function(e){var t,i,r;let o=new Map;if(e.lastMove&&e.highlight.lastMove)for(let t of e.lastMove)te(o,t,"last-move");if(e.check&&e.highlight.check&&te(o,e.check,"check"),e.selected&&(te(o,e.selected,"selected"),e.movable.showDests)){let n=null===(t=e.movable.dests)||void 0===t?void 0:t.get(e.selected);if(n)for(let t of n)te(o,t,"move-dest"+(e.pieces.has(t)?" oc":""));let s=null!==(r=null===(i=e.premovable.customDests)||void 0===i?void 0:i.get(e.selected))&&void 0!==r?r:e.premovable.dests;if(s)for(let t of s)te(o,t,"premove-dest"+(e.pieces.has(t)?" oc":""))}let n=e.premovable.current;if(n)for(let e of n)te(o,e,"current-premove");else e.predroppable.current&&te(o,e.predroppable.current.key,"current-premove");let s=e.exploding;if(s)for(let e of s.keys)te(o,e,"exploding"+s.stage);return e.highlight.custom&&e.highlight.custom.forEach((e,t)=>{te(o,t,e)}),o}(e),w=new Set,k=new Set,y=new Map,C=new Map;for(i=p.firstChild;i;){if(t=i.cgKey,e4(i)){if(r=f.get(t),n=m.get(t),s=b.get(t),o=i.cgPiece,i.cgDragging&&(!v||v.orig!==t)&&(i.classList.remove("dragging"),R(i,u(q(t),c)),i.cgDragging=!1),!s&&i.cgFading&&(i.cgFading=!1,i.classList.remove("fading")),r){if(n&&i.cgAnimating&&o===e9(r)){let e=q(t);e[0]+=n[2],e[1]+=n[3],i.classList.add("anim"),R(i,u(e,c))}else i.cgAnimating&&(i.cgAnimating=!1,i.classList.remove("anim"),R(i,u(q(t),c)),e.addPieceZIndex&&(i.style.zIndex=e7(q(t),c)));o!==e9(r)||s&&i.cgFading?s&&o===e9(s)?(i.classList.add("fading"),i.cgFading=!0):tt(y,o,i):w.add(t)}else tt(y,o,i)}else if(e3(i)){let e=i.className;_.get(t)===e?k.add(t):tt(C,e,i)}i=i.nextSibling}for(let[e,t]of _)if(!k.has(e)){d=(h=C.get(t))&&h.pop();let i=u(q(e),c);if(d)d.cgKey=e,R(d,i);else{let r=W("square",t);r.cgKey=e,R(r,i),p.insertBefore(r,p.firstChild)}}for(let[t,i]of f)if(n=m.get(t),!w.has(t)){if(a=(l=y.get(e9(i)))&&l.pop()){a.cgKey=t,a.cgFading&&(a.classList.remove("fading"),a.cgFading=!1);let i=q(t);e.addPieceZIndex&&(a.style.zIndex=e7(i,c)),n&&(a.cgAnimating=!0,a.classList.add("anim"),i[0]+=n[2],i[1]+=n[3]),R(a,u(i,c))}else{let r=e9(i),o=W("piece",r),s=q(t);o.cgPiece=r,o.cgKey=t,n&&(o.cgAnimating=!0,s[0]+=n[2],s[1]+=n[3]),R(o,u(s,c)),e.addPieceZIndex&&(o.style.zIndex=e7(s,c)),p.appendChild(o)}}for(let t of y.values())e5(e,t);for(let t of C.values())e5(e,t)}(a),o.autoPieces){var t;t=o.autoPieces,function(e,t,i){let r=new Map,o=[];for(let t of e)r.set(t.hash,!1);let n=t.firstElementChild,s;for(;n;)s=n.getAttribute("cgHash"),r.has(s)?r.set(s,!0):o.push(n),n=n.nextElementSibling;for(let e of o)t.removeChild(e);for(let o of e)r.get(o.hash)||t.appendChild(i(o))}(a.drawable.autoShapes.filter(e=>e.piece).map(e=>({shape:e,hash:ti(e),current:!1})),t,e=>(function(e,{shape:t,hash:i},r){var o,n,s;let l=t.orig,a=null===(o=t.piece)||void 0===o?void 0:o.role,h=null===(n=t.piece)||void 0===n?void 0:n.color,d=null===(s=t.piece)||void 0===s?void 0:s.scale,c=W("piece",`${a} ${h}`);return c.setAttribute("cgHash",i),c.cgKey=l,c.cgScale=d,K(c,O(r)(q(l),eg(e)),d),c})(a,e,a.dom.bounds()))}!e&&o.svg&&function(e,t,i){var r;let o=e.drawable,n=o.current,s=n&&n.mouseSq?n:void 0,l=new Map,a=e.dom.bounds(),h=o.autoShapes.filter(e=>!e.piece);for(let t of o.shapes.concat(h).concat(s?[s]:[])){if(!t.dest)continue;let i=null!==(r=l.get(t.dest))&&void 0!==r?r:new Set,o=eX(eH(q(t.orig),e.orientation),a),n=eX(eH(q(t.dest),e.orientation),a);i.add(eY(o,n)),l.set(t.dest,i)}let d=o.shapes.concat(h).map(e=>({shape:e,current:!1,hash:eQ(e,ej(e.dest,l),!1,a)}));s&&d.push({shape:s,current:!0,hash:eQ(s,ej(s.dest,l),!0,a)});let c=d.map(e=>e.hash).join(";");c!==e.drawable.prevSvgHash&&(e.drawable.prevSvgHash=c,function(e,t,i){var r;let o;let n=new Map;for(let i of t.filter(e=>e.shape.dest&&e.shape.brush))o=eV(e.brushes[i.shape.brush],i.shape.modifiers),(null===(r=i.shape.modifiers)||void 0===r?void 0:r.hilite)&&n.set(eB(o).key,eB(o)),n.set(o.key,o);let s=new Set,l=i.firstElementChild;for(;l;)s.add(l.getAttribute("cgKey")),l=l.nextElementSibling;for(let[e,t]of n.entries())s.has(e)||i.appendChild(function(e){let t=eG(ez("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(eG(ez("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}(t))}(o,d,t.querySelector("defs")),function(e,t,i,r){let o=new Map;for(let t of e)o.set(t.hash,!1);for(let e of[t,i]){let t=[],i=e.firstElementChild,r;for(;i;)r=i.getAttribute("cgHash"),o.has(r)?o.set(r,!0):t.push(i),i=i.nextElementSibling;for(let i of t)e.removeChild(i)}for(let n of e.filter(e=>!o.get(e.hash)))for(let e of r(n))e.isCustom?i.appendChild(e.el):t.appendChild(e.el)}(d,t.querySelector("g"),i.querySelector("g"),t=>(function(e,{shape:t,current:i,hash:r},o,n,s){var l,a;let h=eX(eH(q(t.orig),e.orientation),s),d=t.dest?eX(eH(q(t.dest),e.orientation),s):h,c=t.brush&&eV(o[t.brush],t.modifiers),u=n.get(t.dest),p=[];if(c){let e=eG(ez("g"),{cgHash:r});p.push({el:e}),h[0]!==d[0]||h[1]!==d[1]?e.appendChild(function(e,t,i,r,o,n){var s;function l(s){var l;let a=(n&&!o?20:10)/64,h=r[0]-i[0],d=Math.atan2(r[1]-i[1],h),c=Math.cos(d)*a,u=Math.sin(d)*a;return eG(ez("line"),{stroke:s?eB(t).color:t.color,"stroke-width":(t.lineWidth||10)*(o?.85:1)/64+(s?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${s?eB(t).key:t.key})`,opacity:(null===(l=e.modifiers)||void 0===l?void 0:l.hilite)?1:eZ(t,o),x1:i[0],y1:i[1],x2:r[0]-c,y2:r[1]-u})}if(!(null===(s=e.modifiers)||void 0===s?void 0:s.hilite))return l(!1);let a=ez("g"),h=eG(ez("g"),{filter:"url(#cg-filter-blur)"});return h.appendChild(function(e,t){let i={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return eG(ez("rect"),{x:i.from[0],y:i.from[1],width:i.to[0]-i.from[0],height:i.to[1]-i.from[1],fill:"none",stroke:"none"})}(i,r)),h.appendChild(l(!0)),a.appendChild(h),a.appendChild(l(!1)),a}(t,c,h,d,i,ej(t.dest,n))):e.appendChild(function(e,t,i,r){let o=[3/64,4/64],n=(r.width+r.height)/(4*Math.max(r.width,r.height));return eG(ez("circle"),{stroke:e.color,"stroke-width":o[i?0:1],fill:"none",opacity:eZ(e,i),cx:t[0],cy:t[1],r:n-o[1]/2})}(o[t.brush],h,i,s))}if(t.label){let e=t.label;null!==(l=e.fill)&&void 0!==l||(e.fill=t.brush&&o[t.brush].color);let i=t.brush?void 0:"tr";p.push({el:function(e,t,i,r,o,n){var s;let l=.4*.75**e.text.length,a=eJ(i,r,o),h="tr"===n?.4:0,d=eG(ez("g"),{transform:`translate(${a[0]+h},${a[1]-h})`,cgHash:t});d.appendChild(eG(ez("circle"),{r:.2,"fill-opacity":n?1:.8,"stroke-opacity":n?1:.7,"stroke-width":.03,fill:null!==(s=e.fill)&&void 0!==s?s:"#666",stroke:"white"}));let c=eG(ez("text"),{"font-size":l,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return c.innerHTML=e.text,d.appendChild(c),d}(e,r,h,d,u,i),isCustom:!0})}if(t.customSvg){let e=null!==(a=t.customSvg.center)&&void 0!==a?a:"orig",[i,o]="label"===e?eJ(h,d,u).map(e=>e-.5):"dest"===e?d:h,n=eG(ez("g"),{transform:`translate(${i},${o})`,cgHash:r});n.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,p.push({el:n,isCustom:!0})}return p})(e,t,o.brushes,l,a)))}(a,o.svg,o.customSvg)},l=()=>{e8(a),function(e){let t=eg(e),i=O(e.dom.bounds()),r=e.dom.elements.board.firstChild;for(;r;)(e4(r)&&!r.cgAnimating||e3(r))&&R(r,i(q(r.cgKey),t)),r=r.nextSibling}(a),o.autoPieces&&function(e){var t;let i=eg(e),r=O(e.dom.bounds()),o=null===(t=e.dom.elements.autoPieces)||void 0===t?void 0:t.firstChild;for(;o;)K(o,r(q(o.cgKey),i),o.cgScale),o=o.nextSibling}(a)},a=i;return a.dom={elements:o,bounds:n,redraw:(t=!1,()=>{t||(t=!0,requestAnimationFrame(()=>{s(),t=!1}))}),redrawNow:s,unbind:r},a.drawable.prevSvgHash="",e8(a),s(!1),!function(e,t){let i=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&i.addEventListener("contextmenu",e=>e.preventDefault()),e.viewOnly)return;let r=e2(e);i.addEventListener("touchstart",r,{passive:!1}),i.addEventListener("mousedown",r,{passive:!1})}(a,l),r||(a.dom.unbind=function(e,t){let i=[];if("ResizeObserver"in window||i.push(e1(document.body,"chessground.resize",t)),!e.viewOnly){let t=e6(e,eO,eT),r=e6(e,eR,eI);for(let e of["touchmove","mousemove"])i.push(e1(document,e,t));for(let e of["touchend","mouseup"])i.push(e1(document,e,r));let o=()=>e.dom.bounds.clear();i.push(e1(document,"scroll",o,{capture:!0,passive:!0})),i.push(e1(window,"resize",o,{passive:!0}))}return()=>i.forEach(e=>e())}(a,l)),a.events.insert&&a.events.insert(o),a}return ek(i,t||{}),function(e,t){function i(){e.orientation=x(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0,t()}return{set(t){t.orientation&&t.orientation!==e.orientation&&i(),ew(e,t),(t.fen?eS:eE)(e=>ek(e,t),e)},state:e,getFen:()=>{var t;return t=e.pieces,P.map(e=>S.map(i=>{let r=t.get(i+e);if(!r)return"1";{let e=ev[r.role];return"white"===r.color&&(e=e.toUpperCase()),r.promoted&&(e+="~"),e}}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())},toggleOrientation:i,setPieces(t){eS(e=>(function(e,t){for(let[i,r]of t)r?e.pieces.set(i,r):e.pieces.delete(i)})(e,t),e)},selectSquare(t,i){t?eS(e=>en(e,t,i),e):e.selected&&(el(e),e.dom.redraw())},move(t,i){eS(e=>ee(e,t,i),e)},newPiece(t,i){eS(e=>et(e,t,i),e)},playPremove(){if(e.premovable.current){if(eS(ec,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){let i=function(e,t){let i=e.predroppable.current,r=!1;if(!i)return!1;if(t(i)){let t={role:i.role,color:e.movable.color};et(e,t,i.key)&&(X(e.movable.events.afterNewPiece,i.role,i.key,{premove:!1,predrop:!0}),r=!0)}return J(e),r}(e,t);return e.dom.redraw(),i}return!1},cancelPremove(){eE(Y,e)},cancelPredrop(){eE(J,e)},cancelMove(){eE(e=>{eu(e),eK(e)},e)},stop(){eE(e=>{ep(e),eK(e)},e)},explode(t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{eF(e,2),setTimeout(()=>eF(e,void 0),120)},120)},setAutoShapes(t){eE(e=>e.drawable.autoShapes=t,e)},setShapes(t){eE(e=>e.drawable.shapes=t,e)},getKeyAtDomPos:t=>ef(t,eg(e),e.dom.bounds()),redrawAll:t,dragNewPiece(t,i,r){!function(e,t,i,r){e.pieces.set("a0",t),e.dom.redraw();let o=$(i);e.draggable.current={orig:"a0",piece:t,origPos:o,pos:o,started:!0,element:()=>e$(e,"a0"),originTarget:i.target,newPiece:!0,force:!!r,keyHasChanged:!1},eL(e)}(e,t,i,r)},destroy(){ep(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}(r(),r)}(document.getElementById("board"),{movable:{events:{after:(e,t)=>{try{tr.move({from:e,to:t,promotion:"q"})}catch(e){console.error(e)}finally{to.set({fen:tr.fen()})}}}}})}();
//# sourceMappingURL=index.e5b847bc.js.map
